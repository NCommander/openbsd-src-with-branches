Mon Feb 26 16:07:56 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* Version 1.7.2.

Mon Feb 26 1996  Jim Kingdon  <kingdon@cyclic.com>

	* recurse.c (start_recursion): Use last_component rather than
	checking for '/' directly.
	(do_dir_proc): Likewise.

	Visual C++ lint:
	* client.c (send_to_server): Change wrtn to size_t.
	(connect_to_pserver): Put tofd and fromfd declarations inside
	#ifndef NO_SOCKET_TO_FD.
	* scramble.c (shifts): Change from array of char to array of
	unsigned char.

Mon Feb 26 13:31:25 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* server.c (check_repository_password): Remove unused variables
	linelen, ch.

	* client.c (send_file_names): Translate ISDIRSEP characters to '/'.

Sat Feb 24 21:25:46 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* checkout.c (safe_location): Re-indent one line.

Sat Feb 24 10:50:42 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * checkout.c (safe_location): put assignment to hardpath[x] in an
        `else'-clause, so we don't do it when x == -1.

Sat Feb 24 01:40:28 1996  Marcus Daniels  <marcus@sayre.sysc.pdx.edu>
                          via Karl Fogel  <kfogel@floss.red-bean.com>
 
 	* server.c (check_repository_password): Return by reference an
  	  optional username, the `host_user', from the passwd file.  The
  	  host_user will be the user-id under which the cvs repository is
  	  run.
 	  (check_repository_password): Use `read_line' instead of fgets to
  	  allow for passwords larger than 32 characters, as well as the
  	  optional host user argument.
 	  (check_password): Modify to use host_user.
 	  (authenticate_connection): Modify to use host_user.

Sat Feb 24 01:05:21 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * scramble.c (descramble): just shift descrambled string to get
        rid of tag char, instead of allocating a whole new copy.
        (scramble): cast return value of xmalloc to avoid unsightly
        compiler warnings.

        * options.h.in (RCSBIN_DFLT): don't refer to AUTH_SERVER_SUPPORT
        in comment anymore, now that it's not defined in this file.

Fri Feb 23 1996  Jim Kingdon  <kingdon@cyclic.com>

	* client.c: Ifdef HAVE_WINSOCK_H, include winsock.h
	instead of sys/socket.h and friends.
	* login.c: Don't include sys/socket.h and friends.
	* login.c (login): Only fclose fp in the case where it was
	successfully fopen'd.
	* login.c: Declare getpass.
	* filesubr.c, cvs.h (get_homedir): New function.
	* cvsrc.c, expand_path.c, history.c, login.c: Call it instead
	of getenv ("HOME").

Fri Feb 23 09:23:20 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* client.c (connect_to_pserver): Remove unused variable host.
	* login.c: Include getline.h.
	(login): Remove unused variables i and username.
	(get_cvs_password): Move free of linebuf to where it actually will
	be called.  Add a "return NULL" at the end of the function to shut
	up gcc -Wall.

	* options.h.in: Remove AUTH_SERVER_SUPPORT.
	* client.h (authenticate_connection): Declare.
	* scramble.c (scramble): Cast char to unsigned char before using
	it to look up in table (char might be signed).
	* server.c [AUTH_SERVER_SUPPORT]: Include grp.h
	(authenticate_connection): Remove unused variables len and
	server_user.

	* sanity.sh (basica): Add comments regarding creating a top-level
	directory.
	(basic1): Don't try to remove first-dir and
	${CVSROOT_DIRNAME}/first-dir at start of test; tests are now
	responsible for cleaning up at the end.
	(PLUS,DOTSTAR,ENDANCHOR): Add comments regarding fixed GNU expr.

Thu Feb 22 22:34:11 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* cvs.h: Remove alloca cruft.

Wed Feb 21 07:30:16 1996  J.T. Conklin  <jtc@rtl.cygnus.com>

	* modules.c (do_module): call free_cwd before exiting.

	* recurse.c: Removed entries global variable.
	(do_recursion): Declare entries.  Moved call to Entries_Close so
 	entries list is closed on all code paths.
	(start_recursion): Removed call to Entries_Close, entries list has
 	been moved to do_recursion only.

Tue Feb 20 22:10:05 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* update.c (update_dirent_proc): If dir lacks a CVS subdirectory,
	don't recurse into it.
	* sanity.sh (conflicts): Test for above-fixed bug.

	* update.c (merge_file): Use write_letter not printf.

Tue Feb 20 12:34:07 EST 1996: Gary Oberbrunner <garyo@avs.com>
			      and Jim Kingdon <kingdon@cyclic.com>

	* history.c (history_write): Change username to char * and call
	getcaller() to set it.  Setting username accidentally got deleted
	8 Feb 96.
	* sanity.sh: Revise test 64 to test for above-fixed bug.
	* sanity.sh (PLUS): New variable, work around yet another GNU expr
	bug.

Tue Feb 20 14:07:50 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* sanity.sh: Merge test rtags into test basic2.  They never were
	capable of running separately of each other.

	* sanity.sh (deep): New test, to test ability to operate in deeply
	nested directories (more quickly than basic2 test did).
	(basic2,rtags): Remove directories dir3 and dir4.  Remove file8,
	file10, file12, file9, file11, file13, file15, file16, file17.
	These additional files slowed down the tests considerably without
	significantly increasing coverage.

	* sanity.sh (PROG): New variable.  Use it instead of "cvs"
	to match the name cvs prints out for itself.

Mon Feb 19 09:00:29 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	This fixes a bug whereby old default attributes would get
	clobbered instead of added to on "cvs watch add".
	* hash.c (findnode): Don't check for key == NULL; let the
	assertion in hashp take care of it.
	* fileattr.h, fileattr.c (fileattr_get): If filename is NULL,
	return default attributes.

	* client.c (send_repository): Fix indentation.

Mon Feb 19 01:10:01 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * login.c (login): print out full repos so user knows which server
        she's logging into.

        * client.c (send_repository): die if `repos' is NULL.  This is a
        lame solution; see comments in code.

Thu Feb 15 15:04:01 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* error.c (error): Free entire and mess when done with them.

	* sanity.sh (info): Correct syntax of .cvsrc file.

	* cvs.h, expand_path.c, edit.c, parseinfo.c, wrapper.c:
	expand_path now takes arguments containing file and line for error
	message, and it prints the error message itself.
	* sanity.sh (info-6a): Test printing of error message.

	* expand_path.c (expand_variable): Add USER internal variable.
	* sanity.sh (info): Test USER and CVSROOT internal variables too.

Wed Feb 14 19:11:08 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* main.c (usg): Add -s option.

Tue Feb 13 20:26:06 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	gcc -Wall lint:
	* mkmodules.c (mkmodules_usage): Remove declaration of
	non-existent function.
	* cvs.h (mkmodules): Declare.

Mon Feb 12 12:20:04 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* mkmodules.c: Rename main to mkmodules and remove various pieces
	of scaffolding which it used to emulate non-existent parts of CVS.
	Change calling convention to just take a char * not argc,argv.
	Save and restore working directory.
	* commit.c (commit_filesdoneproc): Call it if checking files into
	CVSROOT.
	* Makefile.in (SOURCES): Add mkmodules.c.
	(OBJECTS): Add mkmodules.o.
	(MSOURCES,MOBJECTS): Removed.
	(COMMON_OBJECTS): Removed; move former contents into OBJECTS.
	Update other rules accordingly.
	* sanity.sh: Adjust to reflect nonexistence of mkmodules.

	These changes introduce functions cvs_output and cvs_outerr;
	eventually all server output will go through them rather than
	stdio directly.
	* server.c (saved_output, saved_outerr): New variables.
	(do_cvs_command): Initialize them.
	(buf_output): Don't require that buf->output be set; saved_* use
	this to shove some data in a buffer which buf_copy_lines will
	later want to get data from.
	* server.c, cvs.h (cvs_output, cvs_outerr): New functions.
	* mkmodules.c (cvs_outerr): New function, so error() works.
	* error.c: Reindent.  Don't declare program_name and command_name;
	cvs.h declares them.
	(error): Use vasprintf and cvs_outerr (or fputs in the
	error_use_protocol case) rather than stdio directly.
	* import.c (import_descend_dir): Remove kludge which had prevented
	messages from error() from being out of order with respect to
	messages from printf; cvs_output and cvs_outerr are a cleaner
	solution to the problem.
	(add_log, import): Use cvs_output not printf.
	* update.c (write_letter): Use cvs_output not printf.
	(checkout_file): Use write_letter not printf.
	* sanity.sh: Use dotest for test 56 (test that output is actually
	correct).  In theory should test that the import.c bug is fixed,
	but I was unable to reproduce the bug (it is timing dependent).

Mon Feb 12 16:07:45 1996  Norbert Kiesel  <nk@col.sw-ley.de>

	* commit.c: define last_register_time
	(commit): make sure cvs doesn't exit in the same second it wrote
	the last timestamp
	(commit_fileproc): set last_register_time
	(finaladd): set last_register_time

	* run.c, cvs.h: Changed more Popen() to run_popen()

Mon Feb 12 03:06:50 1996  Benjamin J. Lee  <benjamin@cyclic.com>

	* release.c, rtag.c, tag.c: changed 'delete' to 'delete_flag'
	to avoid symbol collision with DEC C RTL function delete()

Mon Feb 12 03:01:48 1996  Benjamin J. Lee  <benjamin@cyclic.com>

	* mkmodules.c: changed 'void Lock_Cleanup()' to 'void static
	Lock_Cleanup() to avoid conflict with more substantial
	Lock_Cleanup() in lock.c

Mon Feb 12 02:50:19 1996  Benjamin J. Lee  <benjamin@cyclic.com>

	* edit.c, logmsg.c, release.c, run.c: Changed Popen() to
	run_popen().  VMS' linker is not case sensitive and considered
	popen() and Popen() to be identical symbols.

Sun Feb 11 10:51:14 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* main.c (main) [!CLIENT_SUPPORT]: Silently ignore gzip level
	rather than printing usage message.

	* cvs.h, expand_path.c (variable_list): New variable.
	(variable_set): New function.
	* hash.h (enum ntype), hash.c (nodetypestring): Add VARIABLE.
	* expand_path.c (expand_path, expand_variable): Reindent.
	(expand_variable): Use user variables not environment variables
	for ${=VAR} syntax.  The environment variables didn't work
	client/server.
	* main.c (main): Process new -s global option.
	* client.c (send_variable_proc): New function.
	(start_server): Call it, to send user variables.
	* server.c (serve_set): New function.
	(requests): Add Set request.
	* sanity.sh: Revise info test to use user variables rather than
	environment variables.

Sat Feb 10 16:55:37 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	By itself this is only a small cleanup, but in the long run it
	will be way cool (for reference, it takes CVS's text segment from
	290816 bytes to 294912, which I expect will be made up by future
	changes which this enables):
	* cvs.h (struct file_info): Added.
	(FILEPROC): Replace 5 args with single struct file_info *.
	* recurse.c (do_file_proc): Adjust args to fileproc; passed in
	instead of from globals.
	(do_recursion): Call do_file_proc accordingly.  Remove srcfiles
	global variable.
	* update.c (update_fileproc): Renamed from update_file_proc.
	* admin.c, client.c, commit.c, diff.c, edit.c, log.c, patch.c,
	remove.c, rtag.c, status.c, tag.c, update.c, watch.c: Update
	fileprocs to new calling convention.

Fri Feb  9 15:30:32 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* expand_path.c (expand_variable): Accept a variable name starting
	with '=' as a way to specify an environment variable.
	* sanity.sh (info): New tests, for above behavior.

	* Makefile.in (clean): Also remove check.log check.plog.

	* import.c (comtable): Remove SYSTEM_COMMENT_TABLE; the table
	should *not* depend on what kind of machine the server happens to
	be.  Add "mak", "rc", "dlg", "frm", and "bas" types which were
	formerly included via SYSTEM_COMMENT_TABLE.

	* cvs.h, rcs.h, add.c, checkin.c, classify.c, commit.c, diff.c,
	import.c, patch.c, rcs.c, update.c, vers_ts.c: Remove
	DEATH_SUPPORT ifdefs.  They were introduced to facilitate merging
	between Cygnus and Berliner variants of CVS, not because it was
	intended to subset CVS this way.  And they clutter up the code
	quite a bit.
	* cvs.h, create_adm.c, main.c, update.c: Likewise, remove
	CVSADM_ROOT ifdefs (it is still a #define, of course).  I believe
	they had a more-or-less similar motivation.

	* sanity.sh: Move setting of HOME from ignore test to the start of
	the tests so it applies to all tests.
	(CVS): Remove -f; the above change takes care of it.

	* rcs.h (RCS_MERGE): Removed; unused.

	* commit.c (checkaddfile): Fix memory leak.

	* admin.c, commit.c, diff.c, log.c, mkmodules.c: Pass -x,v/ to RCS
	commands.

	* rcscmds.c, cvs.h (RCS_checkin): New function.
	* checkin.c, commit.c, import.c: Call it, rather than run_*.
	* cvs.h, commit.c: Remove DEATH_STATE define; the behavior
	which used to be the default (DEATH_STATE) is now the only one.
	Failing to define DEATH_STATE has been commented as obsolete at
	least since CVS 1.5.  We still can read repositories created with
	such a CVS, however.
	* rcs.h, rcs.c: Adjust comments regarding DEATH_STATE.
	* subr.c (make_message_rcslegal): Add comment, describing
	allocation of returned value.

Fri Feb  9 09:53:44 MET 1996  Norbert Kiesel  <nk@col.sw-ley.de>

	* sanity.sh: use "${testcvs}" instead of "cvs" in devcom tests

	* hash.c: fix "dereferencing a NULL pointer" bug triggered with
	  "cvs watch add"
	(findnode): return NULL if key == NULL
	(hashp): assert (key != NULL)
	
Fri Feb  9 00:46:47 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* rcs.c (RCS_reparsercsfile): Remove unused variable date.

	* myndbm.c (mydbm_load_file): Fix typo ('015' -> '\015').

Thu Feb  8 13:00:00 1996  Jim Kingdon  <kingdon@peary.cyclic.com>

	* rcs.c (RCS_parse, RCS_parsercsfile, RCS_reparsercsfile),
	fileattr.c (fileattr_read), myndbm.c (myndbm_open):
	Use FOPEN_BINARY_READ.
	* fileattr.c (fileattr_write), myndbm.c (myndbm_close):
	Use FOPEN_BINARY_WRITE.
	* history.c (history_write, read_hrecs): Specify OPEN_BINARY.
	* rcs.c: Remove calls to abort.
	* myndbm.c (myndbm_load_file): Ignore CRs from ends of lines
	if present.
	* myndbm.c, fileattr.c: While I am at it, change \n to \012
	a few places where LF is intended.
	* history.c (history_write): Use getenv ("HOME"), not getpwnam,
	to find home directory.  If it isn't set, just keep going; don't
	print a message.
	* rcscmds.c, cvs.h (RCS_checkout): New function.
	* update.c, checkin.c, commit.c, diff.c, import.c, no_diff.c, 
	patch.c: Call it instead of run_*.
	* patch.c (patch_fileproc): Clean up inconsistent handling of
	noexec flag.
	* rcscmds.c (RCS_*): Pass -x,v/ to RCS commands; elsewhere in
	CVS it is assumed that ,v is a suffix.

Fri Feb  2 14:07:32 1996  J.T. Conklin  <jtc@rtl.cygnus.com>

	* rcs.h (struct rcsnode): Remove dates field (list of rcsversnodes
 	indexed by date).  CVS maintained this list for each RCS file even
	though it was never used.  This resulted in higher then necessary 
	memory requirements (and run time too).  Even if revision info was
	needed, CVS' List data structure is inappropriate because can't
	handle duplicate keys.  The above was discovered by tracking down
	a memory leak.
	* rcs.c (RCS_reparsercsfile): Don't build dates list.
	(freercsnode): Don't delete dates list.
	(rcsvers_delproc): Free date field.
	(null_delproc): Removed.
	
Thu Feb  1 12:28:33 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* remove.c (cvsremove): Don't tell user the name of the program
	which they use to remove files; we don't have any way of knowing
	that, and besides which they might use a GUI or emacs 'dired' anyway.
	* update.c (update_filesdone_proc, update_dirleave_proc): Call
	unlink_file_dir instead of rm -rf.
	* options.h.in: Remove RM; no longer used.

	* sanity.sh: New tests devcom-a* test "cvs watch add",
	"cvs watch remove", and "cvs watchers".

	* sanity.sh: New test 171a0 tests for watch.c bug just fixed by kfogel.

	* Most .c files: Remove rcsids.
	* cvs.h: Remove USE macro.

Thu Feb  1 13:07:15 1996  J.T. Conklin  <jtc@rtl.cygnus.com>

	* tag.c, rtag.c: Update various comments to reflect function name
 	changes.

Thu Feb  1 14:14:31 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * recurse.c (do_recursion): comment #endif.

        * edit.c (notify_check): surround with #ifdef CLIENT_SUPPORT; else
        CVS won't compile if CLIENT_SUPPORT is undefined.
        
        * edit.h (notify_check): surround declaration with #ifdef
        CLIENT_SUPPORT.

        * watch.c (watch): if argc <= 1, then just give usage (previously
        was "argc == -1").

Thu Feb  1 12:28:33 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* README-rm-add: Remove information which is now in cvs.texinfo.

	* sanity.sh: Remove basic0 tests.  Move a few to new tests
	basica-1a* (but there is no need to test that *every* command
	gracefully does nothing on an empty directory; exhaustive testing
	is impractical and the generic recursion processor handles this
	anyway).

	* sanity.sh: New tests 69a* test use of update -p to restore old
	version of dead file.

Wed Jan 31 18:32:34 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* ChangeLog-9395: Remove duplicate entries from 1996 which
	accidentally got into this file.

	* client.c (read_line, read_from_server): Change "premature end of
	file from server" message to "end of file from server (consult
	above messages if any)" because 99% of the time it means rsh has
	printed an error message and exited.

Wed Jan 31 15:09:51 1996  J.T. Conklin  <jtc@rtl.cygnus.com>

	* edit.c (ncheck_fileproc): Fix memory leak; free line before
	returning.

Tue Jan 30 18:06:12 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* recurse.c (do_recursion): Add comment about the fact that we
	don't have locks in place at certain points.

Tue Jan 30 09:43:34 1996  Vince Demarco  <vdemarco@bou.shl.com>

	* edit.c (notify_proc): have notify_proc call expand_path with
	the name of the filter program. The user may have used a
	cvs environmental variable. (Popen will expand it, but it may not
	use the correct value)

Tue Jan 30 09:43:34 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* ChangeLog: take the pre-1996 changes and put them in a new file
	ChangeLog-9395.
	* ChangeLog-9194: Renamed from ChangeLog.fsf.
	* ChangeLog-9194, ChangeLog-9395, ChangeLog: Add additional text
	explaining the difference between all these logs and pointing to
	older logs.
	* Makefile.in (DISTFILES): Add ChangeLog-9194 and ChangeLog-9395;
	remove ChangeLog.fsf.

	* modules.c (do_module): Don't fall through from 'l' to 'o' case
	of option processing switch statement.

Tue Jan 30 06:50:19 1996  J.T. Conklin  <jtc@rtl.cygnus.com>

	* client.c (send_repository): Fix memory leak; free adm_name
 	before returning.
	* diff.c (diff_file_nodiff): Fix memory leak; free xvers before
 	returning.
	* rtag.c (rtag_fileproc): Fix memory leak; if branch_mode is set,
 	free rev before returning.
	* status.c (status_fileproc, tag_list_proc): Fix memory leak; free
 	return value of RCS_whatbranch.
	* tag.c (tag_fileproc): Fix memory leak; free vers before
 	returning.
	(val_fileproc): Fix memory leak; free return value of RCS_gettag.
	* watch.c (watch_modify_watchers): Fix memory leak; free mynewattr
	before returning.

Tue Jan 30 09:43:34 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* lock.c (readers_exist): If stat gave an error, print an error
	message saying it was from stat, rather than from "reading
	directory".  Skip the message completely if it was an
	existence_error.

	* sanity.sh (branches): New tests (branches off of branches, etc.).

Tue Jan 30 11:55:34 MET 1996  Norbert Kiesel  <nk@col.sw-ley.de>

	* main.c (main): Add change to run getopt_long twice again.

Mon Jan 29 15:59:31 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	gcc -Wall lint:
	* client.c: Include edit.h

Sun Jan 28 09:45:53 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* edit.c, edit.h (mark_up_to_date): New function, to remove file
	in CVS/Base.
	* client.c (update_entries): Call it if file is up to date.
	* checkin.c (Checkin): Call it in non-server (local) case.
	* sanity.sh: New test 182.5, tests for above-fixed bug.

Sun Jan 28 01:07:22 1996  Jim Kingdon  (kingdon@beezley)

	* client.c (change_mode): Separate out CHMOD_BROKEN code to parse
	mode_string, rather than going through a mode_t.  Cleaner than
	the previous CHMOD_BROKEN code (which also had a typo of && not &).

Sat Jan 27 23:29:46 1996  Jim Kingdon  (kingdon@beezley)

	* edit.c (edit_fileproc): Check for EACCESS as well as EEXIST.

Sat Jan 27 16:26:30 1996  Karl Fogel  (kfogel@floss.cyclic.com)

        * client.c (notified_a_file): use rename_file() instead of
        rename() (but temporarily set `noexec' to 0 so it runs
        unconditionally).
        (change_mode): deal with CHMOD_BROKEN.        

Fri Jan 26 00:14:00 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * server.c: renamed `dirname' to `dir_name', to avoid conflicts
        with system headers.

        * client.c: renamed `dirname' and `last_dirname' to `dir_name' and
        last_dir_name' (see above).  Not strictly necessary, but
        consistency is nice -- as long as you do it all the time.

Thu Jan 25 00:41:59 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * options.h.in (AUTH_SERVER_SUPPORT, AUTH_CLIENT_SUPPORT): change
        comment now that no longer under construction.

Wed Jan 24 15:25:22 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* Version 1.7.1.

	* Version 1.7.

Sat Jan 20 00:05:08 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* Version 1.6.87.

Mon Jan 15 18:14:55 1996  Gary Oberbrunner  <garyo@avs.com>
			  and Jim Kingdon  <kingdon@harvey.cyclic.com>

	* tag.c (val_direntproc):  New function to ignore
	  nonexistent dirs when recursing to check tag validity.
	  (tag_check_valid): Pass it to start_recursion.
	* sanity.sh (death): New tests 65a0-65a6 cause test 74 to test for
	above-fixed bug.

Mon Jan 15 12:55:37 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* main.c: Revert change to run getopt_long twice.  This can go in
	after 1.7.

Mon Jan 15 13:03:28 1996  Norbert Kiesel  <nk@col.sw-ley.de>

	* filesubr.c (deep_remove_dir): added test of EEXIST for nonempty
	  directory (Posix states that both ENOTEMPTY (BSD) and EEXIST
	  (SYSV) are valid)

	* main.c (main): run getopt_long twice to allow command-line
	  suppression of reading the cvsrc file

Fri Jan 12 10:02:43 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* Version 1.6.86.

Thu Jan 11 23:28:05 1996  J.T. Conklin  <jtc@rtl.cygnus.com>
			  and Jim Kingdon  <kingdon@harvey.cyclic.com>

	* fileattr.h (fileattr_startdir): Add comment about REPOS == NULL.
	* fileattr.c (fileattr_read, fileattr_write): Assert that
	fileattr_stored_repos != NULL.
	(fileattr_free): If fileattr_stored_repos is NULL, don't free it.

Thu Jan 11 18:03:21 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * scramble.c (descramble): deal with DIAGNOSTIC better.

Thu Jan 11 12:04:42 1996  Norbert Kiesel  <nk@col.sw-ley.de>

	* main.c: remove CVS_NOADMIN.

	* options.h.in: remove CVS_NOADMIN

Thu Jan 11 10:28:44 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * scramble.c (descramble): make sure the string returned is safe
        to free().

Wed Jan 10 01:11:23 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* server.c (serve_notify): Cast return value from malloc.

	* edit.c (notify_do): Use struct assignment, not struct
	initialization (which SunOS4 /bin/cc doesn't have).

Tue Jan  9 09:41:29 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* Version 1.6.85.

	We use version numbers instead of patchlevels.  But there was some
	confusing patchlevel stuff lying around.  Nuke it:
	* Makefile.in (HEADERS): Remove patchlevel.h
	* patchlevel.h: Removed.
	* main.c: Don't include patchlevel.h.
	(main): Don't print patch level.

	* server.c (check_repository_password): Check for errors from
	system calls; reindent function.

Tue Jan  9 23:15:30 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * expand_path.c: fix comments (explain expand_path()'s behavior
        correctly).

Tue Jan  9 09:41:29 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* edit.c (notify_proc): After copying in string following %s,
	don't clobber it.  Instead set up q to end of string.

	* watch.c (watch_modify_watchers), edit.c (editor_set): Fix sense
	of test in trying to decide whether attributes are changed.

	* cvs.h (CVSROOTADM_USERS): New macro.
	* edit.c (notify_do): Look up notifyee in CVSROOTADM_USERS if it
	exists.

Tue Jan  9 21:39:45 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * expand_path.c: don't redundantly #include things that cvs.h
        already #includes (i.e., stdio.h, ctype.h, string[s].h).

Tue Jan  9 09:41:29 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* ignore.c (ign_default): Add *.obj.

	* server.c: Put /* */ around #endif comment.

Mon Jan  8 20:37:17 1996  Karl Fogel  <kfogel@floss.red-bean.com>

        * client.c (connect_to_pserver): check return value of recv().

Mon Jan  8 11:37:57 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* client.c (connect_to_pserver): Check for error from connect;
	reindent function.

	* sanity.sh (4.75): Use dotest, so we get a PASS if test passes.

	* sanity.sh (dotest): New argument OUTPUT2.
	(188a): Use it instead of \|.

	* sanity.sh (import): Avoid using string $ followed by Id followed
	by $ in sanity.sh source, in case sanity.sh itself is under CVS.
	I hate keyword expansion.

	* sanity.sh: If expr cannot handle multiline expressions, fail and
	tell the user to get one which can.

	* release.c (release_delete): Remove unused variable retcode.

Fri Jan  5 13:30:00 1996  Jim Kingdon   <kingdon@peary.cyclic.com>

	* release.c (release_delete): Call unlink_file_dir rather 
	than "rm -rf".

Thu Jan  4 09:58:30 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* commit.c (find_fileproc): Print "nothing known about foo" and
	return 1 if the file doesn't exist and isn't in CVS/Entries.
	(commit): If the recursion over find_fileproc returns an error,
	print "correct above errors first!" just like local CVS.
	* sanity.sh (basica): Test for above-fixed bug.

	* release.c (release): If we are the client, only unedit if the
	server supports it.

	* sanity.sh: Remove STARTANCHOR stuff; expr patterns are
	automatically anchored to the start.  ENDANCHOR remains.

	* commit.c (commit): Don't start the server until we have
	determined that there is something to commit.

Thu Jan  4 09:48:33 1996  Ben Laurie  <ben@gonzo.ben.algroup.co.uk>
			  and Jim Kingdon  <kingdon@harvey.cyclic.com>

	* client.c (start_server): dup the file descriptor before
	fdopening it.

Wed Jan  3 18:25:25 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* sanity.sh: Remove tests 5, 5.5, and 5.75.  All that stuff is
	tested elsewhere.

	* ignore.c (ign_default): Change CVS* to CVS CVS.adm.  CVS* is too
	broad, especially in a case-insensitive filesystem.

	* Makefile.in (cvsbug): version.c is in srcdir.

Wed Jan  3 17:30:45 1996  Phi-Long Tran  <ptran@autodesk.com>

	* modules.c (do_module): Honor error_use_protocol in printing trace.
	* server.c (server_register): Move check for options NULL to above
	printing of the trace.

Wed Jan  3 01:19:53 1996  Mark Immel <immel@centerline.com>
			  and Jim Kingdon  <kingdon@harvey.cyclic.com>

	* update.c (checkout_file): Do not resurrect file on join if it
	doesn't contain the revisions we are joining.  Probably not a
	perfect test, but should be an improvement.
	* sanity.sh (death): New death-file4-* tests, for bug fixed above.

Wed Jan  3 01:19:53 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* add.c, admin.c, checkout.c, client.c, commit.c, diff.c, edit.c,
	history.c, import.c, log.c, patch.c, release.c, remove.c, rtag.c,
	status.c, tag.c, update.c, watch.c: In calling send_to_server,
	pass \012 not \n.  On the Mac \n is CR, not LF, and we want to
	send LF.  I didn't try to deal with whether files in CVSADM should
	contain CR or LF--in fact there is some code in client.c which
	reads \n from CVSADM files and passes it to send_to_server; it
	needs to be cleaned up one way or the other.

	* entries.c (Entries_Open): Don't try to close fpin twice.

	* client.c (update_entries): Fix typo ("strlen (filename + 10)"
	-> "strlen (filename) + 10").

	* commit.c (checkaddfile): Remove arbitrary limit.

Tue Jan  2 11:25:22 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* commit.c (commit): Only pass files which were modified, added,
	or removed to send_file_names.  This has as a side effect a
	semantic change--the up-to-date check is now skipped for other
	files--but probably a good one, or at least not a bad one.
	* sanity.sh (basica): New test; tests for bug fixed above.
	* sanity.sh (187a3): Adjust for new 'cvs commit' output.  Set up
	DOTSTAR to match arbitrary text (another GNU expr bug/misfeature,
	sigh).

	* sanity.sh: Test that the commit in test 43 actually worked.
	Merge tests basic2 and basic3 and make them independent of basic1.
	(pass,fail): Don't insert spurious space.
	(45.5): Fix typo in directory name.

Tue Jan  2 13:00:00 1996  Jim Kingdon  <kingdon@peary.cyclic.com>

	Visual C++ lint:
	* myndbm.c: Prototype write_item.

Tue Jan  2 11:25:22 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	gcc -Wall lint:
	* client.c (client_expand_modules): Pass error message not "" to error.
	* client.c (supported_request), server.c (supported_response):
	Return a value (gcc -Wall can't know that error doesn't return).
	* commit.c (copy_ulist): Return a value.
	* history.c (fill_hrec): Don't make assumptions about whether
	time_t is "int" or "long" or what.
	* cvs.h: Declare link_file.
	* server.c: Include fileattr.h.
	* server.c (server_notify): Remove unused variable val.
	* tag.c (val_fileproc): Remove unused variable foundtag.

Mon Jan  1 09:49:16 1996  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* Version 1.6.5.

	* Version 1.6.4.

	* filesubr.c (link_file): Add comment about link vs. copy semantics.

	* cvs.h (struct vers_ts): Fix comments.
	* commit.c (commit): Before we ask for a log message, figure out
	what is modified and what is not and pass the information to
	do_editor.
	(copy_ulist,find_fileproc): New helper functions for above code.

	* client.c (read_line): When writing to from_server_logfile, write
	the \n too.

	* client.c (send_files): No longer call send_file_names.
	* client.h: Update comment.
	* add.c, admin.c, commit.c, diff.c, edit.c, log.c, remove.c,
	status.c, tag.c, update.c, watch.c: Call send_file_names before
	send_files.
	* client.c: New variables module_argc, module_argv.
	(client_expand_modules): Set them, to arguments.
	(client_send_expansions): Use them instead of modules_vector to
	send arguments.
	* sanity.sh (modules): Add test of modules -d flag.


For older changes see ChangeLog-9395.
