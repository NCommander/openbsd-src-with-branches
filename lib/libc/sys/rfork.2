.\"
.\" This manual page is taken directly from Plan9, and modified to
.\" describe the actual OpenBSD implimentation. Permission for
.\" use of this page comes from Rob Pike <rob@plan9.att.com>.
.\"
.TH RFORK 2
.SH NAME
rfork \- manipulate process resources
.SH SYNOPSIS
.B #include <sys/param.h>
.br
.B #include <unistd.h>
.PP
.nf
.B
int rfork(int flags)
.fi
.SH DESCRIPTION
Forking or rforking is the only way new processes are created.
The
.I flags
argument to
.I rfork
selects which resources of the
invoking process (parent) are shared
by the new process (child) or initialized to
their default values.
The resources include
the open file descriptor table (which, when shared, permits processes
to open and close files for other processes),
and open files.
.I Flags
is the logical OR of some subset of
.TF RFCNAMEG
.TP
.B RFPROC
If set a new process is created; otherwise changes affect the
current process.
The current implementation requires this flag to always be set.
.TP
.B RFNOWAIT
If set, the child process will be dissociated from the parent. Upon
exit the child will leave no
.B Waitmsg
(see
.IR wait (2))
for the parent to collect.
This is not currently implemented.
.TP
.B RFNAMEG, RFCNAMEG, RFENVG, RFCENVG, RFNOTEG
These are Plan 9 specific flags, and not implimented.
.TP
.B RFFDG
If set, the invoker's file descriptor table (see
.IR intro (2))
is copied; otherwise the two processes share a
single table.
.TP
.B RFCFDG
If set, the new process starts with a clean file descriptor table.
Is mutually exclusive with
.BR RFFDG .
.TP
.B RFMEM
If set, the kernel will force sharing of the entire address space.
The child
will then inherit all the shared segments the parent process owns. Other segment
types will be unaffected.  Subsequent forks by the parent will then
propagate the shared data and bss between children.  The stack segment
is always split.  May be set only with
.BR RFPROC .
.PD
.PP
File descriptors in a shared file descriptor table are kept
open until either they are explicitly closed
or all processes sharing the table exit.
.PP
If
.B RFPROC
is set, the
value returned in the parent process
is the process id
of the child process; the value returned in the child is zero.
Without
.BR RFPROC ,
the return value is zero.
Process ids range from 1 to the maximum integer
.RB ( int )
value.
.I Rfork
will sleep, if necessary, until required process resources are available.
.PP
.I Fork
can be implemented as a call to
.BR rfork(RFFDG|RFPROC)
but isn't for backwards compatibility.
.SH SEE ALSO
.IR intro (2),
.IR fork (2),
.IR minherit (2).

