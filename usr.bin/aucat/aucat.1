.\"	$OpenBSD: aucat.1,v 1.17 2008/05/23 12:56:27 jmc Exp $
.\"
.\" Copyright (c) 2006 Alexandre Ratchov <alex@caoua.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: May 23 2008 $
.Dt AUCAT 1
.Os
.Sh NAME
.Nm aucat
.Nd manipulate linear audio streams
.Sh SYNOPSIS
.Nm aucat
.Bk -words
.Op Fl uq
.Op Fl C Ar min : Ns Ar max
.Op Fl c Ar min : Ns Ar max
.Op Fl d Ar level
.Op Fl E Ar enc
.Op Fl e Ar enc
.Op Fl f Ar device
.Op Fl H Ar fmt
.Op Fl h Ar fmt
.Op Fl i Ar file
.Op Fl o Ar file
.Op Fl R Ar rate
.Op Fl r Ar rate
.Ek
.Sh DESCRIPTION
The
.Nm
utility can record one input stream
and store it on multiple destination files,
doing the necessary conversions on the fly.
It can play, convert, and mix multiple input files simultaneously.
.Nm
also has a legacy mode that works like previous versions of
.Nm ,
which does not convert on the fly and supports playback of .au files.
.Pp
The options are as follows:
.Bl -tag -width "-m mmmmmmmm "
.It Fl C Ar min : Ns Ar max
The range of channel numbers on the output stream.
The default is 0:1, i.e. stereo.
.It Fl c Ar min : Ns Ar max
The range of channel numbers on the input stream.
The default is 0:1, i.e. stereo.
.It Fl d Ar level
The debug level:
may be a value between 0 and 4.
.It Fl E Ar enc
Encoding of the output stream.
The default is signed, 16-bit, native byte order.
.It Fl e Ar enc
Encoding of the input stream.
The default is signed, 16-bit, native byte order.
.It Fl f Ar device
The
.Xr audio 4
device to use for playing and/or recording.
The default is
.Pa /dev/audio .
.It Fl H Ar fmt
File format of the output stream (see below).
The default is auto.
.It Fl h Ar fmt
File format of the input stream (see below).
The default is auto.
.It Fl i Ar file
Add this file to the list of files to play.
The format of the file is specified by the last
.Fl c ,
.Fl e ,
.Fl h ,
and
.Fl r
options.
If the option argument is
.Sq -
then standard input will be used.
.It Fl o Ar file
Add this file to the list of files in which to store recorded samples.
The format of the file is specified by the last
.Fl C ,
.Fl E ,
.Fl H ,
and
.Fl R
options.
If the option argument is
.Sq -
then standard output will be used.
.It Fl R Ar rate
Sample rate in Hertz of the output stream.
The default is 44100Hz.
.It Fl r Ar rate
Sample rate in Hertz of the input stream.
The default is 44100Hz.
.It Fl q
Do not print progress information; run quietly.
.It Fl u
Don't try to automatically determine the optimal parameters for the
audio device;
instead use the parameters specified by the last
.Fl C ,
.Fl c ,
.Fl E ,
.Fl e ,
.Fl H ,
.Fl h ,
.Fl R ,
and
.Fl r
options.
For the
.Fl i
and
.Fl o
options, if
.Fl f
is used then parameters must be specified before it.
.El
.Pp
The following file formats are supported:
.Bl -tag -width s32lexxx -offset -indent
.It raw
Headerless file.
This format is recommended since it has no limitations.
.It wav
Microsoft WAVE file format.
There are limitations inherent to the file format itself:
not all encodings are supported,
file sizes are limited to 2GB,
and the file must support the
.Xr lseek 2
operation (e.g. pipes do not support it).
.It auto
Try to guess, depending on the file name.
.El
.Pp
The following encodings are supported:
.Pp
.Bl -tag -width s32lexxx -offset -indent -compact
.It s8
signed 8-bit
.It u8
unsigned 8-bit
.It s16le
signed 16-bit, little endian
.It u16le
unsigned 16-bit, little endian
.It s16be
signed 16-bit, big endian
.It u16be
unsigned 16-bit, big endian
.It s24le
signed 24-bit, stored in 4 bytes, little endian
.It u24le
unsigned 24-bit, stored in 4 bytes, little endian
.It s24be
signed 24-bit, stored in 4 bytes, big endian
.It u24be
unsigned 24-bit, stored in 4 bytes, big endian
.It s32le
signed 32-bit, little endian
.It u32le
unsigned 32-bit, little endian
.It s32be
signed 32-bit, big endian
.It u32be
unsigned 32-bit, big endian
.It s24le3
signed 24-bit, packed in 3 bytes, little endian
.It u24le3
unsigned 24-bit, packed in 3 bytes, big endian
.It s24be3
signed 24-bit, packed in 3 bytes, little endian
.It u24be3
unsigned 24-bit, packed in 3 bytes, big endian
.It s20le3
signed 20-bit, packed in 3 bytes, little endian
.It u20le3
unsigned 20-bit, packed in 3 bytes, big endian
.It s20be3
signed 20-bit, packed in 3 bytes, little endian
.It u20be3
unsigned 20-bit, packed in 3 bytes, big endian
.It s18le3
signed 18-bit, packed in 3 bytes, little endian
.It u18le3
unsigned 18-bit, packed in 3 bytes, big endian
.It s18be3
signed 18-bit, packed in 3 bytes, little endian
.It u18be3
unsigned 18-bit, packed in 3 bytes, big endian
.El
.Sh LEGACY MODE
If neither
.Fl i
nor
.Fl o
are specified,
.Nm
will run in legacy mode, and won't convert sample formats or sampling rates.
In legacy mode, all options except
.Fl f
are ignored, and all other arguments are assumed to be names of files.
In legacy mode
.Nm
reads files sequentially, and writes them to the specified device.
If a Sun .au header is detected it is skipped over and not copied to
the audio device.
.Nm
will attempt to play data from Sun .au files as monaural 8-bit ulaw
samples with a sampling frequency of 8000 Hz.
However,
.Nm
will not fail if the audio device cannot be configured for these
parameters.
If a Microsoft .wav header (RIFF) is detected it is interpreted
to select the right audio encoding for playback and the data chunk of the
file is copied to the audio device.
If the device does not support the encoding,
.Nm
will exit with an error.
.Sh ENVIRONMENT
.Bl -tag -width AUDIODEVICE
.It Ev AUDIODEVICE
The audio device to use.
.El
.Sh EXAMPLES
The following command will record a stereo s16le stream at
44100Hz from the default device.
If necessary, the stream will be converted and/or resampled
to match parameters supported by the device:
.Bd -literal -offset indent
$ aucat -o file.raw
.Ed
.Pp
The following command will play a stereo s16le stream at
44100Hz on the default device, doing any necessary conversions:
.Bd -literal -offset indent
$ aucat -i file.raw
.Ed
.Pp
The following will mix and play two stereo streams,
the first at 48kHz and the second at 44.1kHz:
.Bd -literal -offset indent
$ aucat -r 48000 -i file1.raw -r 44100 -i file2.raw
.Ed
.Pp
The following will record channels 2 and 3 into one stereo file and
channels 6 and 7 into another stereo file using a 96kHz sampling rate for
both:
.Bd -literal -offset indent
$ aucat -R 96000 -C 2:3 -o file1.raw -C 6:7 -o file2.raw
.Ed
.Pp
The following will play two s18le mono files, one on each channel:
.Bd -literal -offset indent
$ aucat -e s18le -c 0:0 -i f1.raw -c 1:1 -i f2.raw
.Ed
.Pp
The following will mix and play two files and record a third one in
full-duplex:
.Bd -literal -offset indent
$ aucat -i drums.raw -i bass.raw -o guitar.raw
.Ed
.Sh SEE ALSO
.Xr audioctl 1 ,
.Xr cdio 1 ,
.Xr mixerctl 1 ,
.Xr audio 4
.Sh BUGS
The
.Nm
utility assumes non-blocking I/O for input and output streams.
It will not work reliably on files that may block
(ordinary files block, pipes don't).
.Pp
Resampling is low quality; down-sampling especially should be avoided
when recording.
.Pp
CPU usage is the same for all conversions.
It should be smaller for simpler ones.
.Pp
Buffer overruns and underruns are not handled.
.Pp
Processing is done using 16-bit arithmetic,
thus samples with more than 16 bits are rounded.
16 bits (i.e. 97dB dynamic) are largely enough for most applications though.
