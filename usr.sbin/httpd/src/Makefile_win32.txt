# Makefile for Windows NT and Windows 95

# Targets are:
#   _apache    - build Apache in Release mode
#   install    - build and install a Release build
#   clean      - remove (most) files generated by a Release build
#
# The default installation directory is \Apache. This can be changed
# with the INSTDIR macro, for example:
#
#   nmake /f Makefile_win32.txt INSTDIR="d:\Program Files\Apache" install
#
# Note: this does *NOT* change the compiled in default "server root"

!IF "$(INSTDIR)" == ""
INSTDIR=\Apache
!MESSAGE Using default install directory \Apache
!ENDIF 

default:	_apache

_apache: _build

install: _build _install

_build:
	cd os\win32
	 nmake /nologo CFG="ApacheOS - Win32 Release" -f ApacheOS.mak
	cd ..\..
	cd regex
	 nmake /nologo CFG="regex - Win32 Release" -f regex.mak
	cd ..
	cd ap
	 nmake /nologo CFG="ap - Win32 Release" -f ap.mak
	cd ..
	cd main
	 nmake /nologo CFG="gen_uri_delims - Win32 Release" -f gen_uri_delims.mak
	 nmake /nologo CFG="gen_test_char - Win32 Release" -f gen_test_char.mak
	cd ..
	 -del CoreR\buildmark.obj
	 nmake /nologo CFG="ApacheCore - Win32 Release" -f ApacheCore.mak
	 nmake /nologo CFG="Apache - Win32 Release" -f Apache.mak
	cd os\win32
	 set CFG=ApacheModuleStatus - Win32 Release
	 nmake /nologo CFG="ApacheModuleStatus - Win32 Release" -f ApacheModuleStatus.mak
#	 nmake /nologo CFG ""/nologo -f ApacheModuleStatus.mak"=ApacheModuleInfo - Win32 Release" -f ApacheModuleInfo.mak
	 nmake /nologo CFG="ApacheModuleAuthAnon - Win32 Release" -f ApacheModuleAuthAnon.mak
	 nmake /nologo CFG="ApacheModuleDigest - Win32 Release" -f ApacheModuleDigest.mak
	 nmake /nologo CFG="ApacheModuleCERNMeta - Win32 Release" -f ApacheModuleCERNMeta.mak
	 nmake /nologo CFG="ApacheModuleExpires - Win32 Release" -f ApacheModuleExpires.mak
	 nmake /nologo CFG="ApacheModuleHeaders - Win32 Release" -f ApacheModuleHeaders.mak
	 nmake /nologo CFG="ApacheModuleSpeling - Win32 Release" -f ApacheModuleSpeling.mak
	 nmake /nologo CFG="ApacheModuleUserTrack - Win32 Release" -f ApacheModuleUserTrack.mak
	 nmake /nologo CFG="ApacheModuleRewrite - Win32 Release" -f ApacheModuleRewrite.mak
	cd ..\..
	cd modules\proxy
	 nmake /nologo CFG="ApacheModuleProxy - Win32 Release" -f ApacheModuleProxy.mak
	cd ..\..

_install:
	-mkdir $(INSTDIR)
	-mkdir $(INSTDIR)\modules
	-mkdir $(INSTDIR)\logs
	-mkdir $(INSTDIR)\conf
	copy ApacheR\Apache.exe $(INSTDIR)
	copy CoreR\ApacheCore.dll $(INSTDIR)
	copy os\win32\ApacheModuleStatusR\ApacheModuleStatus.dll $(INSTDIR)\modules
#       copy os\win32\ApacheModuleInfoR\ApacheModuleInfo.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleAuthAnonR\ApacheModuleAuthAnon.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleDigestR\ApacheModuleDigest.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleCERNMetaR\ApacheModuleCERNMeta.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleExpiresR\ApacheModuleExpires.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleHeadersR\ApacheModuleHeaders.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleRewriteR\ApacheModuleRewrite.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleSpelingR\ApacheModuleSpeling.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleUserTrackR\ApacheModuleUserTrack.dll $(INSTDIR)\modules
	copy modules\proxy\Release\ApacheModuleProxy.dll $(INSTDIR)\modules

clean:
	cd os\win32
	 nmake /nologo CFG="ApacheOS - Win32 Release" -f ApacheOS.mak clean
	cd ..\..
	cd regex
	 nmake /nologo CFG="regex - Win32 Release" -f regex.mak clean
	cd ..
	cd ap
	 nmake /nologo CFG="ap - Win32 Release" -f ap.mak clean
	cd ..
	cd main
	 nmake /nologo CFG="gen_uri_delims - Win32 Release" -f gen_uri_delims.mak clean
	 del uri_delims.h
	 nmake /nologo CFG="gen_test_char - Win32 Release" -f gen_test_char.mak clean
	 del test_char.h
	cd ..
	 nmake /nologo CFG="ApacheCore - Win32 Release" -f ApacheCore.mak clean
	 nmake /nologo CFG="Apache - Win32 Release" -f Apache.mak clean
	cd os\win32
	 nmake /nologo CFG="ApacheModuleStatus - Win32 Release" -f ApacheModuleStatus.mak clean
#	 nmake /nologo CFG="ApacheModuleInfo - Win32 Release" -f ApacheModuleInfo.mak clean
	 nmake /nologo CFG="ApacheModuleAuthAnon - Win32 Release" -f ApacheModuleAuthAnon.mak clean
	 nmake /nologo CFG="ApacheModuleDigest - Win32 Release" -f ApacheModuleDigest.mak clean
	 nmake /nologo CFG="ApacheModuleCERNMeta - Win32 Release" -f ApacheModuleCERNMeta.mak clean
	 nmake /nologo CFG="ApacheModuleExpires - Win32 Release" -f ApacheModuleExpires.mak clean
	 nmake /nologo CFG="ApacheModuleHeaders - Win32 Release" -f ApacheModuleHeaders.mak clean
	 nmake /nologo CFG="ApacheModuleSpeling - Win32 Release" -f ApacheModuleSpeling.mak clean
	 nmake /nologo CFG="ApacheModuleUserTrack - Win32 Release" -f ApacheModuleUserTrack.mak clean
	 nmake /nologo CFG="ApacheModuleRewrite - Win32 Release" -f ApacheModuleRewrite.mak clean
	cd ..\..
	cd modules\proxy
	 nmake /nologo CFG="ApacheModuleProxy - Win32 Release" -f ApacheModuleProxy.mak clean
	cd ..\..
 	cd os\win32\installer\installdll
	 nmake /nologo CFG="install - Win32 Release" -f install.mak clean
	cd ..\..\..

installdll:
 	cd os\win32\installer\installdll
	 nmake /nologo CFG="install - Win32 Release" -f install.mak
	cd ..\..\..
