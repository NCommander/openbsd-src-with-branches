2000-12-31  Assar Westerlund  <assar@sics.se>

	* configure.in: do not include <sys/vnode_if.h>, it gets included
 	by <vnode.h> and may not reside in <sys/>

2000-12-30  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* xfs/linux/xfs_inodeops.c: Rewrote xfs_lookup to make use of the
	2.2.8 interface. Now xfs_lookup returns the dentry, which suits us
	much better.

	* xfs/bsd/xfs_syscalls-common.c: Don't allow fhget/fhopen when
	compiling for Darwin. fhget/fhopen leaks vnodes when used on
	Darwin.

2000-12-23  Love  <lha@stacken.kth.se>

	* conf/CellServDB (zepa.net): added first cell w/o hosts

2000-12-21  Love  <lha@stacken.kth.se>

	* configure.in: check for res_init()
	* lib/ko/kocell.c (cell_init): call res_init() to initialize the
	resolver.

	* lib/ko/Makefile.in: change the way $(LIBS) is used
	* include/Makefile.in: added @LIBS@ to program built locally
	
2000-12-21  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_putpages): make it build on
 	NetBSD-current
	* configure.in: test for putpages.sync to differentiate between
 	NetBSD and FreeBSD putpages

2000-12-18  Assar Westerlund  <assar@sics.se>

	* appl/vos/*.c: do not call inet_ntop when getnameinfo fails, just
	set a constant string

	* tests/mmap-and-read.c (main): remove extra print to make it
	consitent with all the other tests

2000-12-15  Assar Westerlund  <assar@sics.se>

	* appl/vos/vos_examine.c (printvolstat): only set `sin_len' if
	there's such a field
	* appl/vos/vos_syncsite.c (vos_syncsite): only set `sin_len' if
	there's such a field
	* appl/vos/vos_vldbexamine.c (printvolstat): only set `sin_len' if
	there's such a field

2000-12-12  Love  <lha@stacken.kth.se>

	* appl/vos/*.c: fix getaddrinfo calls, print numeric address in
	case we fail

2000-12-11  Love  <lha@stacken.kth.se>

	* xfs/linux/xfs/xfs_locl.h: added list_for_each
	* doc/*: improvements
	
2000-12-07  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs/xfs_locl.h: use nline instead of __inline for
	consistency

2000-12-04  Love  <lha@stacken.kth.se>

	* arlad/arla-cli.c (print_dir_long): check it we followed a
	mountpoint to ourself, in that case, bail out.

2000-12-01  Love  <lha@stacken.kth.se>

	* doc/*: improve text, add text, improve indices, spellcheck

2000-11-29  Love  <lha@stacken.kth.se>

	* arlad/inter.c (potential_update_dir): change to it take a child
	entry and a parent to make sure we don't deadlock when trying to
	lock the parent.
	(cm_rename): when moving the child entry between directories, make
	sure we update the child's parent. Pass down the child and the new
	parent to potential_update_dir

2000-11-28  Love  <lha@stacken.kth.se>

	* arlad/arla-cli.c: rename the consistency checking function
	* arlad/arla.c: rename the consistency checking function
	* arlad/arla_local.h: rename the consistency checking function
	* arlad/arlad.c: rename the consistency checking function
	* arlad/cmcb.c: rename the consistency checking function
	* arlad/fcache.c (*): rename the consistency checking function
	(get_root_of_volume): if we are found ourself when following a
	mountpoint, just return
	* arlad/inter.c (*): rename the consistency checking function
	(cm_symlink): check if the symlink points to ourself, then don' chase
	it it since then we'll deadlock
	* arlad/inter.h: rename the consistency checking function
	
2000-11-27  Love  <lha@stacken.kth.se>

	* appl/pts/pts.c (dump_cmd,dump_1): remove the need to give a host
	
2000-11-26  Love  <lha@stacken.kth.se>

	* arlad/fcache.c (fs_downp): replace with host_downp()
	(*): replace a occurrences of fs_downp with host_downp(); instead of
	checking the return value is RX_CALL_DEAD, use host_downp() to see
	it the error is from a `dead' fileserver; also, replace all
	RX_CALL_DEAD with ARLA_CALL_DEAD.
	
	* arlad/fs_errors.h: translate Rx errors to ARLA_ equivalent
	
	* arlad/conn.h (host_downp): new
	* arlad/conn.c (host_downp): return True is the error means that
	the host is down

	* rx/rx.h (RX_{MIN,MAX}_ERROR): minimum and maximum rx error
	values

2000-11-25  Love  <lha@stacken.kth.se>

	* ydr/output.c: try to use some more int32_t as return values
	
	* rx/rx.c (rxi_SendCallAbort, rxi_SendConnectionAbort): don't send
	a long, send a int32_t

2000-11-25  Marcus Sundberg  <mackan@stacken.kth.se>

	* xfs/linux/bin/Makefile.in: sed -e 'expr ; expr' doesn't work with
	older GNU sed, do it the old fashioned way instead.

2000-11-25  Love  <lha@stacken.kth.se>

	* doc/*.texi: reorganized the text, added index, and detailed nodes
	* doc/afs-basics.texi: some more text about fs and vldb relations
	* doc/real-world.texi: some real world problems
	
	* arlad/fcache.c (cleaner): check if entry is locked before trying
	to clean it out, lock node before unlinking it from the lru
	
	* xfs/linux/xfs_node.c (xfs_node_users): use xfs_dcount
	* xfs/linux/xfs/xfs_locl.h (xfs_dcount): added

	* xfs/linux/xfs_load.c (init_module): make devfs_register work for
	2.4, patch from Chris Kuklewicz <chrisk@MIT.EDU>
	
2000-11-23  Love  <lha@stacken.kth.se>

	* arlad/dynroot.c (dynroot_get_node): use
	fcache_mark_as_mountpoint() to mark the symlinks as mountpoints.
	* arlad/fcache.c (fcache_mark_as_mountpoint): new function
	(update_entry): use fcache_mark_as_mountpoint
	* arlad/fcache.h (fcache_mark_as_mountpoint): prototype
	
	* lib/ko/kocell.c (readcellservdb): reset dbserver when creating a
	new cell, otherwise new cell might get the previous cell's
	hostinformation.
	(readdb): set timeout to 0, since this is static information

2000-11-16  Love  <lha@stacken.kth.se>

	* xfs/linux/xfs_message.c (xfs_invalid_node): break out node
	counting stuff to xfs_node_users
	* xfs/linux/xfs_node.c (xfs_node_users): new function, return
	number of users
	
	* xfs/bsd/xfs_vnodeops-common.c (xfs_inactive_common): is stale,
	reclaim at once.
	* xfs/bsd/xfs_message.c (xfs_message_invalidnode): is data is
	used, make it as stale
	* xfs/linux/xfs_node.c (free_all_xfs_nodes): call
	xfs_force_invalid_xnode instead of xfs_invalid_xnode
	* xfs/linux/xfs_inodeops.c: s,xfs_iread,xfs_icount,
	* xfs/linux/xfs_message.c (xfs_force_invalid_xnode): break out
	parts of xfs_invalid_xnode
	(xfs_invalid_node): mark node as stale if there is users left
	* xfs/linux/xfs_vfsops.c (xfs_notify_change): clear attributes
	before rpc
	(xfs_put_inode): if data is stale and this is the last user, flush data
	* xfs/linux/xfs/xfs_locl.h (xfs_icount): rename xfs_iread
	(xfs_iwritecount): add
	* xfs/linux/xfs/xfs_fs.h (xfs_force_invalid_xnode): add new
	function

2000-11-15  Love  <lha@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_setattr): clear attr token before
	rpc, not after

	* appl/lib/arlalib.c (arlalib_try_next_db): try next db-server on
	RX_CALL_DEAD

	* xfs/linux/xfs_inodeops.c (xfs_lookup): wrap errno in ERR_PTR
	
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_unlock): don't print internal
	structure of v_interlock

	* util/log.c: make it pass the regression test
	* util/util-tester.c: add :notime, renumber, add "all" target, and
	print "all" and "-all"

2000-11-14  Love  <lha@stacken.kth.se>

	* arlad/fcache.c: revert 1.301->1.300 until I have a brain (it
	should sleep now) to write this code more beatuify and at the same
	time working.
	
2000-11-07  Love  <lha@stacken.kth.se>

	* arlad/fcache.c (read_data): remove bogus assert, data can have
	changed inbetween fetchstatus and fetchdata
	
2000-11-04  Love  <lha@stacken.kth.se>

	* xfs/solaris/xfs_vnodeops.c: implement xfs_getpage, xfs_putpage,
	xfs_delmap and xfs_addmap modify xfs_map to do the page handling
	itself.

2000-11-03  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c: make all loop-over-all-file-servers simpler and
	more uniform

2000-11-03  Love  <lha@stacken.kth.se>

	* rxdef/common.h: CALLBACK_VERSION is the current version of the
	callback
	
2000-11-02  Love  <lha@stacken.kth.se>

	* arlad/.gdbinit: add some volcache debugging stuff
	
2000-11-02  Assar Westerlund  <assar@sics.se>

	* configure.in: remove unused vfs* tests
	* xfs/bsd/bin/mount_locl.h: remove unused MOUNT_XFS stuff
	* xfs/bsd/bin/mount_xfs.c: always mount filesystem by name, except
 	on OSF.  remove all code for auto-loading.

2000-10-31  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_createvobject,
 	xfs_destroyvobject, xfs_getvobject): add new methods, needed for
 	FreeBSD-5-current

	* cf/bsd-func-suser.m4: add <sys/systm.h>
	* xfs/bsd/xfs_dev-bsd.c (__FreeBSD__) xfs_dev: conditionalize
	d_bmaj
	* configure.in: test for cdevsw.d_bmaj

	* util/log.c (log_open_syslog): add LOG_NDELAY per default,
	otherwise program that do chroot may fail to open the syslog
	socket later

2000-10-28  Love  <lha@stacken.kth.se>

	* Release 0.34.6, see the branch for relevant patches

	* xfs/solaris/xfs_vnodeops.c (xfs_map): add debugging statement
	that show is a program mmap:s of the end of a file.  Add add gross
	hack that flush all mmaped files to server if they are mmap R/W
	XXX.
	(*): indent

2000-10-27  Love  <lha@stacken.kth.se>

	* arlad/solaris-subr.c (write_dirent): use strcpy to copy name and
	check size of reclen so it isn't larger then blocksize.
	* arlad/inter.c (cm_lookup): if we are looking up . make sure we
	don't set `res' to value of parent

2000-10-26  Love  <lha@stacken.kth.se>

	* xfs/solaris/xfs_message.c (xfs_message_installnode): avoid
	holding node mutex when doing VN_RELE() since that might cause a
	VOP_INACTIVE if the node happend to fall out of the dnlc
	
2000-10-25  Love  <lha@stacken.kth.se>

	* arlad/inter.c (cm_lookup): try avoid doing bulkstat when doing
	lookup on .

	* xfs/solaris/xfs_message.c (xfs_message_installdata): HOLD the
	vnode when doing a dnlc_purge_vp since it might not be used, and
	that will result in a VOP_INACTIVE and recusive mutex enter panic
	in xfs_inactive.

	* xfs/solaris/xfs_message.c (xfs_message_installdata): make the
	lookup by path code work again, ident

	* arlad/solaris-subr.c: (write_dirent): DTRT re the size of the
	name, don't do sizeof() when you mean strlen.

	* **/Makefile.in: make distclean target consistent

2000-10-24  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* arlad/fcache.c: Assert return value from listadd*

2000-10-24  Love  <lha@stacken.kth.se>

	* appl/pts/pts.c (*): expand cellname
	
2000-10-20  Assar Westerlund  <assar@sics.se>

	* arlad/*.c: use AssertLockOwner and AssertNotLockOwner

	* lwp/lock.h (AssertLockOwner, AssertNotLockOwner): print the
	current locker, and print file:line correctly, add trailing
	newline
	 (AssertExclLocked, AssertNotExclLocked): add two new macros for
	users to verify that a lock is (not) held

2000-10-20  Love  <lha@stacken.kth.se>

	* lwp/lock.c (Lock_Init): set thread_index
	* lwp/lock.h (struct Lock): thread_index is the thread that have a
	exclusive lock
	(Obtain.*, Release.*): check owner of lock
	* lwp/{plwp,lwp_asm}.h: define LWP_INVALIDTHREADID

2000-10-19  Love  <lha@stacken.kth.se>

	* xfs/solaris/xfs_vfsops.c (xfs_{,u}mount): initialize/delete the
	mutex's in struct xfs
	* xfs/solaris/xfs_dev.c: don't init the struct xfs since it
	belongs to the filesystem

	* xfs/solaris/xfs_dev.c: indent
	
2000-10-18  Assar Westerlund  <assar@sics.se>

	* arlad/arla-cli.c (default_log_file): change to /dev/stderr, it's
	much more useful for an interactive program to output errors and
	warnings where they're immediately visible

2000-10-18  Love  <lha@stacken.kth.se>

	* Release 0.34.5, see the branch for relevant patches

	* configure.in: check for strlcpy
	
	* xfs/linux/xfs_inodeops.c (*): return error if filename is too
	long

	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_common): do copy of
	label diffrently
	(xfs_symlink_common): check length of symlink content

	* xfs/include/xfs/xfs_message.h (XFS_MAX_SYMLINK_CONTENT): define
	for size largest symlink that can be passed in the rpc system.
	* xfs/linux/xfs_dev.c (enqueue_message): fixed wrong debug printf
	
	* xfs/*/xfs_common.c: added strlcpy
	* xfs/*/xfs_[iv]nodeops*.c: avoid overrun the filename in the
	upcall packet
	* xfs/*/xfs_message.c (xfs_message_installdata): terminate the
	cache_name string

2000-10-17  Love  <lha@stacken.kth.se>

	* Release 0.34.4, see the branch for relevant patches

2000-10-16  Love  <lha@stacken.kth.se>

	* arlad/fcache.c (get_root_of_volume): finish un-finished comment
	
2000-10-15  Assar Westerlund  <assar@sics.se>

	* xfs/rhapsody: remove this (to the attic).  it is probably not
	useful for anybody, and the new MacOS X port of this code has been
	integrated into xfs/bsd
	* lwp/make-process.o.sh.in: remove (unsued) rhapsody case
	
	* lib/ko/kocell.c (cell_getcellbyhost): make it consistent as
	related to memory allocation.  now always returns non-malloced
	memory.

	* tests/make-page.c: make it work without MMAP_ANON
	* appl/lib/ka-procs.c: remove dupliate include files, add fallback
	definitions for DES_ENCRYPT and fix types
	* xfs/bsd/bin/Makefile.in (startarla): also substitute libexecdir
	* xfs/bsd/bin/startarla.in (PATH): also include libexecdir to find
	arlad

2000-10-15  Love  <lha@stacken.kth.se>

	* arlad/arlad.c (arla_start): don't send USR1 when not forking
	
	* arlad/messages.c (xfs_message_rmdir): msg0 is of type
	xfs_message_installdata

	* arlad/inter.c (cm_getattr): if data isn't in kernel, make sure
	to mask way the open-mask too

	* doc/debugging.texi: some more debugging help
	
2000-10-14  Love  <lha@stacken.kth.se>

	* xfs/linux/xfs_message.c (xfs_message_installdata): look at
	XFS_ID_HANDLE_VALID flag and make sure we fall back on
	path_init/path_wait/open_namei if its not there.
	(xfs_message_installnode): print tokens

	* xfs/solaris/xfs_message.c (xfs_message_installdata): look at the
	XFS_ID_HANDLE_VALID flag and panic if not set
	
2000-10-14  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* xfs/bsd/xfs_message.c (xfs_message_installdata): Only use handle
	if XFS_ID_HANDLE_VALID is set

	* arlad/*.c: Use fcache_cache_handle. Set XFS_ID_HANDLE_VALID.

	* arlad/{arlad.c,arla.c,arla-cli.c,arla_local.h}: Fork early and
	wait for SIGUSR1

	* xfs/include/xfs/xfs_message.h: Add XFS_ID_HANDLE_VALID

	* xfs/bsd/xfs_vfsops-macos.c: Dead vnodes should use nop locking

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): check for NULL vnode
	from VGET

2000-10-14  Love  <lha@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_read_file): 2.4: check if the data
	is valid valid before calling generic_file_read.
	
	* tests/invalidate-file.c: use fs_invalidate, better errormessages
	* tests/invalidate-file.c: invalidate files when they are used.
	
	* lwp/lwp_asm.c: clean up some, allocate some STACK_HEADROOM in
	first call to savecontext(), unify some cases, remove unused stuff
	* lwp/lwp_asm.h: define AFS_LWP_MINSTACKSIZE to (100 * 1024) in
	all cases, make comment match

	* INSTALL: simplify the chardevice node text, 0.5 is a LONG time
	ago.  add text about kgcc and rh7.0;

	* lwp/process.ppc.S: document PowerPC Stack structure
	* xfs/linux/xfs_inodeops.c (xfs_write_file): validate data before
	writing to file
	* tests/run-tests.in (ARLA_TESTS): run copy-file
	* tests/copy-file: copy a file several times
	
	* configure.in (linux): allow overriding of KERNEL_CC
	
	* appl/kalog/kalog.c: improve the user-interface
	* appl/lib/ka-procs.c: remove usused variable
	
2000-10-12  Love  <lha@stacken.kth.se>

	* xfs/linux/xfs_dev.c (struct xfs_channel, xfs_queue_inactive,
	xfs_process_inactive_queue): protect inactive_list too
	
	* xfs/linux/xfs_dev.c (enqueue_message): common parts of
	xfs_message_send, protect updating of sequence-number
	(xfs_process_inactive_queue): use enqueue_message instead of xfs_message_send
	(xfs_message_send): moved body to enqueue_message
	(xfs_devread): process inactive queue
	(xfs_message_send): process inactive queue
	(xfs_message_rpc): process inactive queue, protect updating of sequence-number
	(struct xfs_channel): document what channel_sem is protecting

	* tests/create-symlinks.c: verify contents
	
2000-10-11  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): do not send SIGABRT,
	only useful when debugging

	* configure.in: call AC_KRB_IPV6 (we might end up getting some
	library such as libinet6 that gives us getnameinfo et al)

2000-10-11  Love  <lha@stacken.kth.se>

	* lib/ko/gensysname.c: make it match sparc64 too
	* tests/fhbench.c: include <sys/ioccom.h> if exist
	* lib/roken: make getaddrinfo stuff work
	* **/Makefile.in: wack everything until it seems to work
	* arlad/solaris-subr.c: remove _KERNEL, solaris don't need it.
	
2000-10-10  Love  <lha@stacken.kth.se>

	* lib/roken: remove strmatch.c, inaddr2str.c, str2inaddr.c
	
	* configure.in: check for sin_len
	* appl/*/*.[ch]: use getaddrinfo/getnameinfo
	* lib/ko/gensysname.c (main): use fnmatch instead of strmatch
	* arlad/afsdir_check.c: use arla_local.h
	* arlad/arla_local.h: define O_BINARY is not defined.
	* ydr/output.[ch]: break out eefile from libroken
	* ydr/main.c: break out strange libroken functions
	
2000-10-09  Love  <lha@stacken.kth.se>

	* lib/ko/ports.c: initialize ports to random value to fool
	darwin's ranlib

2000-10-08  Assar Westerlund  <assar@sics.se>

	* rx/rxdebug.c (*): check that the socket fd is not too large to
	select on
	* rx/rx_pkt.c (osi_NetSend): check that the socket fd is not too
	large to select on
	* lwp/testlwp.c (selectConsumer): check that the fd is not too
	large to select on
	* arlad/kernel.c (kernel_opendevice): check that the fd is not too
	large to select on
	* appl/afsutils/klog.c (do_timeout): check for the fd being too
	large to be able to select on
	* rx/rx_user.c: static-ize some variables and check that the
	socket fd is not too large
	* rx/rx_globs.h: remove some variables that are only used in
	rx_user

2000-10-08  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* xfs/bsd/xfs_vnodeops-bsd.c, xfs/bsd/xfs_vnodeops-common.c: Mac
	OS X UBC fixes

	* configure.in: Check which library to include to get pthreads
	support

2000-10-08  Love  <lha@stacken.kth.se>

	* lib/ko/kocell.c: improve dns handling
	* appl/*/Makefile.in: Add depency on arlalib
	
	* appl/kalog/kalog.c: use new ka_ interface
	* appl/lib/Makefile.in: add ka-procs.[ch], install headerfiles
	* appl/lib/ka-procs.h: KA server interfaces.
	* appl/lib/ka-procs.c: KA server interfaces. Currently implemented
	is Authenticate and GetTicket.
	
2000-10-07  Love  <lha@stacken.kth.se>

	* rxdef/ka.xg: added GetTicket and random fixes
	* arlad/services.h: added ka missing services

2000-10-06  Love  <lha@stacken.kth.se>

	* configure.in: added kalog
	* appl/Makefile.in (SUBDIRS): added kalog
	* appl/kalog/kalog.c: simple klog program need some cleaning
	in the user-interface
	* appl/kalog/Makefile.in: makefile for kalog
	
2000-10-04  Love  <lha@stacken.kth.se>

	* ydr/output.c: try to handle encoding strings
	
	* arlad/inter.c (cm_lookup): avoid deadlock when looking up .. in
	a volume root

	* xfs/bsd/xfs/xfs_locl.h: don't include <vm/...> headers on a uvm
	only system
	* configure.in: check if we are a uvm only system
	* cf/bsd-uvm-only.m4: add a uvm vs vm test
	
2000-10-03  Love  <lha@stacken.kth.se>

	* arlad/dynroot.c (dynroot_update_entry): set unitmodebits for
	mountpoints
	* lib/ko/kocell.c (celldebug_units): add a almost-all
	* util/log.c (parse_word): fixet parsing and implement best_match
	
	* **/*.[chly]: Removed advertising clause.

2000-10-02  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* include/afssysdefs.h, xfs/bsd/xfs/xfs_syscalls.h,
	xfs/bsd/xfs_syscalls-wrap-bsd.c: Added afssysdefs.h
	
	* xfs/bsd/xfs_dev-bsd.c: xfs_is_xfs_dev should only be defined
	once on Mac OS X
	
	* arlad/inter.c: Transarc doesn't check permissions on directory
	FetchStatus

2000-10-02  Harald Barth  <haba@pdc.kth.se>

	* rx/rx_queue.h: If it will segfault, get it at early as possible.
	* rx/rx.c: Asserts to find when the congestionQueue breaks

2000-10-02  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* lib/ko/gensysname.c: Added ppc_macosx

2000-10-02  Love  <lha@stacken.kth.se>

	* arlad/bsd-subr.c: don't define _KERNEL since it not used

2000-09-30  Assar Westerlund  <assar@sics.se>

	* arlad/*-subr.c, arlad/arla_local.h: 'move the required magic for
	getting DIRSIZ et al from dirent.h into the *-subr.c files, since
	it is different on all OSes

	* util/log.c (syslog_opt_units): conditionalize the different
	openlog flags

2000-09-29  Assar Westerlund  <assar@sics.se>

	* rx/rx_user.c (ADDRSPERSITE): bump to 256 to work-around a bug in
	older FreeBSD

2000-09-29  Love  <lha@stacken.kth.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lookup): merge the EJUSTRETURN
	and 0 cases

2000-09-28  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* xfs/bsd/xfs/xfs_locl.h: include sys/ubc.h on darwin
	
	* xfs/bsd/xfs_vfsops-bsd.c, xfs/bsd/xfs_node-bsd.c,
	xfs/bsd/xfs_vnodeops-bsd.c: darwin ubc handling fixed

	* xfs/bsd/xfs_syscalls-common.c, xfs/bsd/xfs_vfsops-common.c:
	darwin copyinstr requires valid 4th argument
	
2000-09-28  Love  <lha@stacken.kth.se>

	* rx/rxperf.c: getopt'ify to make it possible to link agaist
	transarc libs
	* arlad/arlad.8: remove paths
	
2000-09-27  Love  <lha@stacken.kth.se>

	* xfs/bsd/bin/Makefile.in: move programs to sbin
	
	* arlad/inter.c: deal with followmountpoint change
	* arlad/fcache.h: new signature of followmountpoint
	* arlad/fcache.c (followmountpoint): add parameter to pass down
	parent FCacheEntry

	* arlad/volcache.c: (get_info_byname): cast volname_len to int
	when doing a .*s printf

	* arlad/Makefile.in: deal with arlad/arla-cli changes
	* arlad/arla.c: break out daemon/test parts
	* arlad/arla_local.h: export part of arla{,-cli,d}.c
	* arlad/arlad.8: created from arlad.1
	* arlad/arla-cli.8: document, new file
	* arlad/arlad.c: daemon parts of arla.c
	* arlad/arla-cli.c: pull out command line specific parts of arla.c
	* arlad/ThisCell.5: fix refenceses

2000-09-25  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* arlad/arlad.1: Corrected referred filenames

2000-09-25  Love  <lha@stacken.kth.se>

	* lib/ko/kocell.c (readdb,readcellservdb): make less picky about
	whitespace.

	* appl/fs/Makefile: include arladebu.o
	* appl/lib/Makefile: don't include arladeb.o

	* arlad/Makefile.in (afsdir_check_OBJS): don't need arladeb.o
	any more
	* arlad/afsdir_check.c: don't need arla_loginit

	* arlad/arladeb.c: moved functions around
	* arlad/arladeb2.c: removed: functions moved to arladebug.c
	* arlad/arladebu.c: exported parts of arla debug interface
	
	* arlad/fcache.c (fcache_get): set pag to ARLA_NO_AUTH_CRED, not 0

	* xfs/linux/xfs_dev.c (xfs_print_sleep_queue): use
	HAVE_WAIT_QUEUE_TASK_LIST
	* configure.in: check for linux/stddef.h and wait-queue->task_list
	* cf/linux-type-wait-queue-task_list.m4: check for
	wait-queue->task_list

2000-09-25  Assar Westerlund  <assar@sics.se>

	* config.sub: update to version 2000-09-11 (aka 1.181) from
	subversions.gnu.org

	* config.guess: update to version 2000-09-05 (aka 1.156) from
	subversions.gnu.org plus some minor tweaks

2000-09-20  Love  <lha@stacken.kth.se>

	* conf/arla.spec.in: make it (maybe) work with suse
	* xfs/linux/bin/Makefile.in: look for init.d directories at some
	more places

2000-09-19  Love  <lha@stacken.kth.se>

	* lwp/Makefile.in (clean): remove process.S, its a symlink created
	by make-process.o.sh

2000-09-18  Love  <lha@stacken.kth.se>

	* conf/CellServDB (admin.kth.se): added malvolio.admin.kth.se

	* Release 0.34.3, see the branch for relevant patches
	
2000-09-16  Love  <lha@stacken.kth.se>

	* tests/fhbench.c: a fhopen bench program

2000-09-15  Love  <lha@stacken.kth.se>

	* arlad/fcache.c (truncate_file): remove assert that new
	filelength shold be the length that we specified, since old
	fileserver just seems to do wrong with it.

2000-09-14  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_message.c (xfs_message_installnode): grab a
	reference to the parent dentry while it's being used

2000-09-13  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_dev.c (sigisactive, sigissignaled): handle both
 	old style `current->signal' and 2.4.0-test8 style
 	`current->pending.signal'

	* configure.in (linux): test for `struct task_struct.pending',
 	added in 2.4.0-test8

2000-09-12  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs/xfs_dev.h (xfs_channel): add `proc' to save who is
 	connection to this channel new prototypes

	* xfs/bsd/xfs_dev-common.c (xfs_devread, xfs_devwrite): save the
 	proc used in the channel
	(xfs_message_rpc): check to avoid deadlocks caused by arlad
	calling xfs that would cause rpcs sent to arlad

2000-09-09  Love  <lha@stacken.kth.se>

	* appl/vos/vos_status.c (printstatus): print volume name here,
	indent
	* appl/udebug/udebug.1: specify section
	* arlad/arlad.1: clairify how to start arlad
	* arlad/arla.conf.5: the return of the mandoc maffia
	
2000-09-08  Love  <lha@stacken.kth.se>

	* tests/run-tests.in: added fchmod and truncate
	
2000-09-06  Love  <lha@stacken.kth.se>

	* util/log.c (syslog_facility_units): add #ifdef junk for broken
	OS that doesn't have LOG_foo
	* appl/bos/Makefile.in: added mandir
	* rx/Makefile.in: added mandir
	
2000-09-05  Love  <lha@stacken.kth.se>

	* appl/udebug/udebug.c (myctime): dont use %c to strftime
	* util/log.c (log_vprint_file): don't use %c to strftime
	(log_open_syslog): make shorter

2000-09-04  Love  <lha@stacken.kth.se>

	* appl/*/*.c: (main): log_open use :notime

	* util/log.c: added options
	* lib/ko/ko_locl.h: include <log.h>
	* lib/ko/ko.h: include <log.h>
	* lib/ko/kocell.c: use log_log for debugging
	* appl/udebug/udebug.c: try to clear up myctime warnings
	
2000-09-02  Love  <lha@stacken.kth.se>

	* ydr/output.c: differate variable declaration and function
	(prototype) declaration make max sized string (string foo<10>)
	have fixed size in variable declaration, and be a pointer in
	function declarations

	* **/*.[ch]: fixed missing agetarg stuff
	
2000-09-01  Love  <lha@stacken.kth.se>

	* **/*.[ch]: use agetarg where approriate
	* lib/ko/agetarg.[ch]: introduce wacked agetarg
	* lib/roken/getarg.[ch]: change to heimdal 0.3a's libroken
	* arlad/arlad.1: --dynroot
	* arlad/CellServDB.5: more AFSDB religion
	
2000-09-01  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* arlad/messages.c (try_again): Handle RXKADSEALEDINCON and
	RXKADUNKNOWNKEY
	* arlad/volcache.c (get_info_loop): Handle RXKADSEALEDINCON and
	RXKADUNKNOWNKEY

2000-08-31  Love  <lha@stacken.kth.se>

	* arlad/messages.c: make more consistent, make all fcache_get_data
	calls loop on try_again
	* arlad/messages.c (xfs_message_getdata): don't pass NULL as fid
	to try_again, since if the error is from VBUSY, it try to print
	the fid, and since fid is NULL it will crash.
	* rxdef/bos.xg: added missing ;
	
2000-08-30  Love  <lha@stacken.kth.se>

	* appl/bos/*.c: indent, make work, correct, refit to new bos.xg
	* rxdef/bos.xg: try to make it more correct
	
2000-08-29  Love  <lha@stacken.kth.se>

	* appl/bos/Makefile.in: install manual pages
	* appl/bos/bos.8: added initial manualpage
	* doc/storage.texi: more about volume management
	* doc/afs-basics.texi: corrent dns example
	* lib/ko/kocell.c: always read suidcell when starting

2000-08-28  Love  <lha@stacken.kth.se>

	* xfs/solaris/xfs_node.c (new_xfs_node): pass in parentnode to
	avoid deadlock when "." is entered.
	(*): start doing locking on xnode
	* xfs/solaris/xfs/xfs_node.h (struct xfs_node): add a mutex to
	lock the struct, add a comment that struct vnode needs to be
	first.
	* xfs/solaris/xfs_node.c (free_xfs_node): if we are next_node,
	point it on node after us

2000-08-27  Love  <lha@stacken.kth.se>

	* xfs/solaris/xfs_message.c (gc_vnode): lock vnode when looking at
	v_count
	* xfs/solaris/xfs_node.c (new_xfs_node): protect nodes list
	(free_xfs_node): protect nodes list, make sure to update the
	next_node pointer
	(xfs_node_iter_start): start a iteration of the nodes list
	(xfs_node_iter_next): get next node in iteration
	(xfs_node_iter_stop): end iteration of the nodes list
	(xfs_node_find): use new list iteration function
	(free_all_xfs_nodes): use new list iteration function
	* xfs/solaris/xfs_message.c (xfs_message_gc_nodes): use new
	interation functions on nodelist
	* xfs/solaris/xfs_dev.c (xfs_dev_attach): call xfs_init_xfs() to
	init struct xfs
	(xfs_dev_detach): call xfs_destroy-xfs to free usage of struct xfs
	* xfs/solaris/xfs_wrap.c (_fini): disallow unloading of module
	that still used
	* xfs/solaris/xfs_vfsops.c (xfs_unloadable): return 0 is xfs is
	unloaded
	(xfs_init_xfs): init mutexed related to struct xfs
	(xfs_destroy_xfs): destroy mutexes related to struct xfs
	(xfs_uprintf_filsys): use literation functions
	* xfs/solaris/xfs/xfs_fs.h (struct xfs): added mutex'es for list
	protection add new prototypes
	* xfs/solaris/xfs_syscalls.c (xfs_uninstall_setgroups): avoid
	unload if never loaded
	(xfs_setgroups): protect with p->p_crlock

2000-08-26  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_dev.c: remove some old stuff make some macros
	into functions
	(xfs_message_rpc): add signals to blocked set

2000-08-26  Love  <lha@stacken.kth.se>

	* xfs/solaris/xfs_dev.c (xfs_message_rpc): mask SIGPOLL, SIGALRM,
	and SIGVTALRM while doing the rpc

2000-08-26  Love  <lha@stacken.kth.se>

	* lib/ko/Makefile.in: change order of KRB4_LIB_FLAGS and libroken
	
	* xfs/solaris/xfs/xfs_locl.h: added <sys/signal.h>
	* xfs/solaris/xfs_dev.c: allocate xfs_channel->message_buf at
	attach/detach moment protect xfs_channel->message_buf with mutex
	convert some printf to XFSDEB
	* xfs/solaris/xfs_dev.c: lock messageq and sleepq, initial SMP
	support use a macro to get ddi_get_soft_state() add some comments
	
	* tests/write-closed2.c: include more stuff to make it work on
	solaris

2000-08-25  Love  <lha@stacken.kth.se>

	* lwp/process.m68k.S: make the `register % hack' depend on __ELF__

2000-08-25  Assar Westerlund  <assar@sics.se>

	* arlad/volcache.c: replace some strncpy with strlcpy, and make a
	too long volume name an error
	* arlad/fcache.c: replace some strcpy with strlcpy
	* arlad/arla.c (main): use the correct cell and not `0'
	
	* arlad/messages.c (try_again): get anonymous credentials in the
	correct cell
	(xfs_message_getroot, viocgettok)): use the correct cell and not `0'
	(viocsetacl): only malloc the required space

2000-08-24  Love  <lha@stacken.kth.se>

	* arlad/arladeb{2,}.[ch]: new log_log
	* util/util-tester.c: added new test for log
	* util/log.[ch]: enable subsystem to log
	* util/log_log.3: added manualpage
	* util/Makefile.in (LIBS): change order of including libroken and
	@LIBS@

2000-08-21  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* xfs/solaris/bin: Added startarla and modctl

2000-08-20  Tomas Olsson  <tol@stacken.kth.se>

	* rxdef/cb.xg: don't convert addr_in & subnetmask in struct
	interfaceAddr

	* tests/write-closed.c (doit): cast MAP_FAILED to void *

	* tests/write-closed2.c: include atypes.h
	(doit): cast MAP_FAILED to void *

2000-08-20  Assar Westerlund  <assar@sics.se>

	* ydr/output.c: inherit flags to the elements of of an
	array/varray

	* tests/write-closed.c, write-closed2.c: new tests

2000-08-19  Magnus Ahltorp  <ahltorp@ahltorp.nada.kth.se>

	* Release 0.34.2, see the branch for relevant patches

2000-08-19  Assar Westerlund  <assar@sics.se>

	* configure.in: update smp-test on linux to newer kernels: more
	header files are necessary when doing the cpp test and uppercase
	characters when grepping /proc/ksyms
	* cf/krb-bigendian.m4: re-write this so that it hopefully it works
	correctly

2000-08-17  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-common.c (xfs_fsync_common): give up and
 	throw away data when called from reclaim
	(xfs_inactive_common): use printf so that user seems the failed
	writing-back

	* xfs/bsd/xfs/xfs_locl.h: try including all vm-related files that
 	we find

	* configure.in: actually test if we found krb4 for deciding to
 	build rxkad, not just that we were looking for it

2000-08-16  Love  <lha@stacken.kth.se>

	* appl/lib/fs_lib.c (fs_get_sysname): fix strlcpy
	(fs_getcells): fix strlcpy, argument i a len not a size
	* appl/lib/arlalib.h (fs_getcells): fix prototype
	
2000-08-15  Love  <lha@stacken.kth.se>

	* arlad/messages.c (xfs_message_symlink): update usage of
	cm_symlink
	* arlad/inter.c (cm_symlink): convert to take a FCacheEntry
	instead of a VenusFid

2000-08-14  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_message.c (clear_all_children): make it invalidate
	this dcache entry iff `parent'.  fix all callers.

2000-08-13  Love  <lha@stacken.kth.se>

	* doc/arla.texi: add new files and nodes
	* doc/afs-basics.texi: spelling
	* doc/intro.texi: update platforms, and add arla-commit
	* doc/oddities.texi: mountpoints
	* doc/authors.texi: updata
	* doc/Makefile.in: added new files
	* doc/{storage,timeline}.texi: new random texts
	* doc/history.txt: merged into info document
	* doc/{partsofarla,,porting,servers,tools,ack,debugging}.texi: Id police

2000-08-13  Love  <lha@stacken.kth.se>

	* arlad/arla.c (recover): don't revover by default

2000-08-13  Assar Westerlund  <assar@sics.se>

	* configure.in: check for uvm/uvm_extern.h

	* xfs/bsd/xfs/xfs_locl.h: use uvm/uvm_extern.h instead of vm/vm*.h
 	if it exists

2000-08-11  Love  <lha@stacken.kth.se>

	* configure.in: enable to disable compiling xfs
	
2000-08-10  Tomas Olsson  <tol@stacken.kth.se>

	* lib/bufdir/fbuf.c (malloc_flush): reorder args to lseek()

2000-08-09  Mattias Amnefelt  <mattiasa@e.kth.se>

	* conf/CellServDB: Updated club.cc.cmu.edu

2000-08-08  Love  <lha@stacken.kth.se>

	* arlad/fcache.c (getroot): don't die when we cant find the root
	volume, don't enter volccache_getbyname more then one time XXX the
	later should be fixed in volcache
	
2000-08-06  Love  <lha@stacken.kth.se>

	* Release 0.34.1 relased, see the branch for relevant patches

2000-08-06  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_syscalls.c (remote_pioctl): also interpret ENXIO
	as the daemon not being there and therefore mapped into EINVAL
	
2000-08-06  Love  <lha@stacken.kth.se>

	* appl/afsutils/Makefile.in (MANPAGES): += klog.1 aklog.1
	* appl/afsutils/aklog.1: add manulpage
	* appl/afsutils/*.1: mandoc'ify, and clean u
	
	* appl/afsutils/aklog.c: use "TheseCells" if there is no arguments
	* lib/ko/kocell.c (cell_expand_cell): expand in the same order as
	CellServDB
	(readthesecells): read a "TheseCells" file and add them to the ofst of
	TheseCells
	(addthesecell): add a new cell to the thesecells list, permit no dups.
	(cell_init): also parse the TheseCells files

	* appl/afsutils/aklog.c: Added aklog from Brandon S. Allbery
	<allbery@ece.cmu.edu>, rewrote it a little bit.
	* appl/afsutils/Makefile.in: added aklog
	
	* appl/lib/arlalib.c (arlalib_get_viceid_servers): return the
	errorcode

	* cf/c-attribute.m4: check for old gcc that can't eat
	__attribute__ ((unused)) bar (void) { return ; }

	* Release 0.34

	* configure.in (CHECK_KERBEROS): need to check for both krb4 and
	krb5 since libkafs might depend on both.

2000-08-03  Love  <lha@stacken.kth.se>

	* lib/cmd/cmd.c (parse_magic_options): don't abort(), break
	
2000-08-04  Love  <lha@stacken.kth.se>

	* cf/check-kafs.m4: check if libkafs needs to be linked against
	libkrb5, libkrb4 or both

2000-08-02  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (get_attr_bulk): try to not leak memory from
 	bulkstatus.  handle any number of returned status
	* arlad/fcache.c (get_attr_bulk): actually break out when
	RXAFS_BulkStatus fails

	* arlad/arla.c: move chroot later
	
2000-08-02  Harald Barth  <haba@pdc.kth.se>

	* LIESMICH: Polish german.
	* README: Small hint

2000-08-02  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c (main): chroot to cache_dir to avoid influencing
	anything

	* xfs/bsd/xfs_vnodeops-common.c (xfs_open_common): store the
	`cred' in the xfs_node for later
	(xfs_inactive_common): fsync the vnode (with the stored cred)
	* xfs/bsd/xfs_vnodeops-osf.c (xfs_open): call xfs_open_common
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_open): call xfs_open_common
	* xfs/bsd/xfs_node-bsd.c (xfs_getnewvnode): initialize `cred'
	(free_xfs_node): free `cred'
	* xfs/bsd/xfs/xfs_node.h (xfs_node): add `cred'

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): remove `length'
	parameter when copying

	* rx/rxdebug.c: printf format correctness

2000-07-30  Assar Westerlund  <assar@sics.se>

	* lib/ko/kocell.c: complain once if we fail to open */ThisCell
	don't complain about missing SuidCells
	* lib/ko/kocell.c: do not write warnings about configuration files
	found in /usr/vice instead of /usr/arla.  read suid cell
	information on demand.

2000-07-28  Love  <lha@stacken.kth.se>

	* lwp/make-process.o.sh.in (HOST_CPU): nbsd/pmax uses mipsl, catch
	that one too.

2000-07-24  Tomas Olsson <tol@stacken.kth.se>

	* appl/fs/fs.c (mkmount_cmd): simple support for cell as third arg

2000-07-23  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_lookup_int): always call
	cache_lookup with LOCKPARENT | ISLASTCN to make sure the returned
	parent node is locked.
	(xfs_dnlc_lock): implement common function for doing the first half of
	the required locking (the second half is done in xfs_lookup) after
	fetching an entry from the cache.  depending on the implementation
	of cache_lookup, this has to be done always or only when
	cache_lookup failed

	* xfs/bsd/xfs_dev-bsd.c: treat _LKM and KLD_MODULE the same way
	* xfs/bsd/xfs_syscalls-common.c: treat _LKM and KLD_MODULE the
	same way
	(lookup_node): remove unused `done'

2000-07-17  Love  <lha@stacken.kth.se>

	* xfs/linux/*.c: dentry->d_child is atomic_t on linux 2.4-test3
	
2000-07-16  Love  <lha@stacken.kth.se>

	* rx/rxperf.c: rx test perf program
	 * conf/CellServDB (cs.unc.edu): update
	
2000-07-14  Simon Josefsson  <jas@vic20.blipp.com>

	* cf/check-kerberos.m4 (AC_KRB4_INC_WHERE): Typo.
	(AC_KRB5_LIB_WHERE1): Try -lresolv too.

2000-07-12  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_message.c (xfs_message_invalidnode): try not to
 	throw away nodes that act as backing store for dirty vm objects

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_putpages): call underlying putpages

	* lwp/Makefile.in: always install lwp headerfile as lwp.h

	* xfs/include/xfs/xfs_message.h (XFS_FSYNC): add flag
	* xfs/linux/xfs_inodeops.c (xfs_fsync): add flag
	* xfs/*/xfs_vnodeops*.c (xfs_fsync): set fsync bit
	* arlad/inter.c (cm_close): propagate fsync bit to fs

	* arlad/messages.c (viocwhereis): use volcache_volid2bit and only
	return relevant file servers
	* arlad/fcache.c (find_first_fs): use volcache_volid2bit
	* arlad/volcache.h (volcache_volid2bit): add prototype
	* arlad/volcache.c (volcache_volid2bit): new function

2000-07-08  Love  <lha@stacken.kth.se>

	* arlad/volcache.c (recycle_entry): assert the the entry isn't
	used, free any parent
	(get_free_entry): make sure the this node isn't a parent node before
	recycling it
	(volcache_getby{name,id}): if refcount == 0, 
	inc nactive_volcacheentries since the entry just started to
	be used (after try_reuse or creation)
	(add_entry_by{name,id}): move ++nactive_volcacheentries
	resposibility to caller.
	(try_reuse): relocate

2000-07-06  Assar Westerlund  <assar@sics.se>

	* rx/rx_pkt.c (rxi_EncodePacketHeader, rxi_DecodePacketHeader):
	generalize the code to work where sizeof(u_int32_t) != 4

2000-07-03  Harald Barth  <haba@pdc.kth.se>
	
	* tests/dir-tree: haba version, now without bash features
	* tests/shallow-tree: with haba dir-tree
	* tests/deep-tree: with haba dir-tree

2000-07-02  Assar Westerlund  <assar@sics.se>
	
	* arlad/fcache.c (update_entry): look at `fake_mp'
	* arlad/arla_local.h (fake_mp): add
	* arlad/arla.c: add `--fake-mp'

	* arlad/fcache.c (followmountpoint): set parent
	* arlad/fcache.c: redo fake and real mountpoint stuff

	* arlad/messages.c (update_fid); try handling flags better
	(xfs_message_getdata): translate errors in common case

	* tests/visit-volumes: new test
	
2000-06-27  Love  <lha@stacken.kth.se>
	
	* appl/bos/bos_status.c: indent and some cleaning
	* appl/bos/bos.c (cmds): added apropos, help, quit
	

2000-07-02  Tomas Olsson  <tol@stacken.kth.se>

	* lib/ko/koerror.c (koerr_gettext): make ret const
	* lib/bufdir/fdir.c (fdir_creat): return EEXIST when appropriate

2000-07-01  Assar Westerlund  <assar@sics.se>

	* arlad/inter.c (cm_symlink): do not let the user choose 0644 bits
	for a symlink, because then we could confuse it with a mount point

2000-06-30  Assar Westerlund  <assar@sics.se>

	* appl/vos/vos_examine.c: be more robust when the volume server
	returns errors

2000-06-26 Love <lha@stacken.kth.se>
	
	* arlad/messages.c (xfs_message_remove): it seems silly but remove
	can cause a bulkstatus, pass the parent to fcache_verify_attr to
	avoid a deadlock.

2000-06-26  Tomas Olsson  <tol@stacken.kth.se>

	* lib/ko/koerror.c (koerr_gettext): never return NULL
	* tests/dir-tree: syntax

2000-06-25  Tomas Olsson  <tol@stacken.kth.se>

	* appl/vos/vos_createentry.c: check helpflag

2000-06-25  Assar Westerlund  <assar@sics.se>

	* appl/lib/arlalib.c (arlalib_get_viceid): update to
	cell_dbservers_by_id
	* arlad/volcache.c: adapt to new cell_dbservers_by_id
	* arlad/arla.c (usage): print help correctly
	* arlad/afsdir_check.c (usage): fix to print usage correctly
	* arlad/messages.c: adapt to new cell_dbservers_by_id and
	cell_new_dynamic
	* lib/ko/Makefile.in: remove kodebug
	* lib/ko/kocell.c: look up AFSDB records also for the case of an
	existing cell that has no database servers.  record cells
	dynamically added in CellServDB
	* lib/ko/ko_locl.h: remove kodebug.h
	* lib/ko/ko.h: update to new prototypes from kocell.c
	
	* xfs/linux/xfs_vfsops.c (xfs_put_inode): change back the i_count
 	test to the comparison it was
	(xfs_delete_inode): fix printf of i_count
	* xfs/linux/xfs_inodeops.c (xfs_release_file): use xfs_iread for
 	accessing i_count

	* arlad/fcache.c (purge_volume): handle wildcard cells that can
	result from volume callbacks from multi-homed file servers
	* arlad/volcache.c (volcache_invalidate): handle wildcard cells
	that can result from volume callbacks from multi-homed file
	servers

	* lib/ko/kocell.c: make all cell name comparisons case-insensitive

2000-06-24  Love  <lha@stacken.kth.se>

	* rxdef/vldb.xg: add some more flag
	
2000-06-24  Harald Barth  <haba@pdc.kth.se>

	* tests/rm-rf.c: closedir() is good - do not die from too many
	open files in big trees
	* tests/deep-tree: Fast version does a not-so-deep-tree
	* tests/create-files.c: Not only the first file should be of given
	size

2000-06-23  Assar Westerlund  <assar@sics.se>

	* appl/afsutils/klog.c (main): use fgets for reading the password

2000-06-23  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_message.c (gc_vnode): use xfs_iread
	* xfs/linux/xfs_vfsops.c (xfs_read_super): set error = 0 when we
	use path_init/path_tree
	(xfs_put_inode,xfs_delete_inode): use xfs_iread
	* xfs/linux/xfs/xfs_locl.h (xfs_iread): use for reading of i_count
	(xfs_iref): change to use atomic_read

2000-06-22  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs/xfs_msg_locl.h (xfs_message_updatefid): add
	prototype
	* xfs/solaris/xfs_message.c (xfs_message_updatefid): add
	* xfs/solaris/xfs_dev.c (xfs_message_receive): add updatefid

2000-06-19  Assar Westerlund  <assar@sics.se>

	* arlad/subr.c (dentry2ino): actually handle all the cases:
	- . at the root of a volume
	- .. at the root of a volume
	- .. pointing to the root of the volume
	- all other

	* arlad/fcache.c (fcache_realfid): try to return the right fid for
	(*,1,1)
	* arlad/fcache.c (invalidator): check that the heap has not
	mutated while sleeping

	* appl/pts/pts.c (main): add an terminating element (NULL) in
	myargv

2000-06-18  Harald Barth  <haba@pdc.kth.se>

	* LIESMICH: Follow README

2000-06-17  Assar Westerlund  <assar@sics.se>

	* configure.in (openbsd): set _LKM (should really come from
	bsd.lkm.mk)

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lookup): locking protocol is
	more complex.  if we're returning in *vpp the same node that we
	got in dvp, we should not unlock it.
	* xfs/bsd/xfs_vnodeops-common.c: add some extra (#if 0 code)
	(xfs_readdir): fetch length from cache vnode with getattr
	(xfs_reclaim_common): don't set v_data to NULL

2000-06-16  Assar Westerlund  <assar@sics.se>

	* configure.in: check for com_err.h and et/com_err.h

	* xfs/linux/bin/arla.init.in: do start and top in a somewhat more
	debian-compatible way.  based on a patch from Adrian Bridgett
	<adrian.bridgett@iname.com>

	* ydr/lex.h (yylex): add prototype

	* arlad/fcache.c (fcache_fhopen, fcache_fhget): do not probe

	* configure.in: check for com_err.h and et/com_err.h

	* xfs/linux/bin/arla.init.in: do start and top in a somewhat more
	debian-compatible way.  based on a patch from Adrian Bridgett
	<adrian.bridgett@iname.com>

2000-06-15  Love  <lha@s3.kth.se>

	* appl/afsutils/klog.c: backed out cmd changes
	
2000-06-12  Love  <lha@s3.kth.se>

	* cf/check-kerberos.m4: do the krb4 extra lib check the same way
	as the krb5 case, there is no need to check for the include, since
	if the user have choose a prefix explicity, they get
	includedir=$prefix

2000-06-12  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (break_callback): reset attrusedp and
 	datausedp, otherwise we still think they are in use when we turn
 	on kernelp again.

2000-06-12  Harald Barth  <haba@pdc.kth.se>

	* doc/intro.texi: Be more precise about support status
	* doc/arla.info: Follows intro.texi
	* cf/check-kerberos.m4: run AC_KRB{4,5}_{LIB,INC}_WHERE even when
	                        --with-krb{4,5}=/path is specified
	
2000-06-10  Assar Westerlund  <assar@sics.se>

	* lwp/process.sparc.S (sunos4): also define STACK_BIAS

	* tests/apwd.c: add verbosity.
	(getcwd_classic): print the correct string in the verbose output

	* tests: allow overriding FS

	* appl/fs/fs_local.h (PRIMARY_CELL, SETUID_HONORED,
 	OBSOLETE_VERSION): redefine in terms of constants from kafs.h
	* appl/fs/fs.c (afs_getcellstatus): use fs_getcellstatus
	(lsmount_cmd, rmmount_cmd): only print error messages when it actually
	failed

	* tests/apwd.c: clarify error messages

	* arlad/subr.c (dentry2ino): rewrite, hopefully simpler

	* arlad/xfs.h: update for new version handling
	* arlad/kernel.c (version_thread): update to new version message
	* arlad/xfs.c: update to new version message
	* xfs: (invalidnode): do not print warnings when node not found.
	(updatefid): add some implementations
	(version): add some handlers
	* xfs/include/xfs/xfs_message.h: make version number-based and not
	capability based.  change all modules.
	(XFS_ID_AFSDIR): add new flag for installdata
	(XFS_VERSION): set version

	* xfs/linux/xfs_inodeops.c (xfs_readdir): data is not valid when
	trying to read from a bad fake mount point, so do not print
	anything then

	* arlad/fcache.c (fcache_get_data): be more careful replacing a
	fake mount-point
	(find_volume): handle cases of missing types of volumes better

2000-06-10  Love  <lha@s3.kth.se>

	* rx/Makefile.in (rxdebug): added @LIBS@
	
	* lib/cmd/testc.c (main): call set_progname
	
	* tests/rm-rf.c (main): do right with argc
	
	* arlad/xfs.c (*): try do to the right thing from kern_write()
	
	* xfs/linux/xfs_message.c (*): set return values to be negative
	
2000-06-09  Love  <lha@s3.kth.se>

	* tests/run-tests.in: use rm-rf instead of rm -rf when removing
	the tree for paranoia resons.

	* tests/rm-rf.c (do_dir): if we have afs, try to do fs_rmmount on
	each directory
	(main): check for afs

	* appl/fs/fs.c (lsmount_cmd,rmmount_cmd): use fs_\1
	* appl/lib/fs_lib.c (fs_lsmount,fs_rmmount): added, moved from
	fs.c

	* arlad/fcache.c (fcache_get_data): set TYPE_LINK when converting
	to a mountpoint

	* arlad/messages.c (xfs_message_link): change if #if 1 to #if 0
	that I apprently changed with last commit, changed order of
	free:ing dir_entry
	(xfs_message_symlink): update to new
	break_callback, free dir_entry later
	(*): remove #if 0 code that tried to
	break_callback instead of installing new data.

2000-06-09  Harald Barth  <haba@pdc.kth.se>

	* doc/authors.texi: spell

2000-06-08  Love  <lha@s3.kth.se>

	* arlad/fcache.c (invalidator): updated to new style
	break_callback
	* arlad/messages.c (break_callback): make it take a FCacheEntry
	instead of a Fid, now it sets flags.kernelp = FALSE too.
	(*): update all calls to break_callback and updated semantics
	* arlad/messages.h (break_callback): update prototype
	
	* arlad/reconnect.c: fix compiler warnings
	* rx/Makefile.in (include_HEADERS): added rxgencon.h

2000-06-08  Assar Westerlund  <assar@sics.se>

	* appl/vos/vos_status.c (vos_status): check for server and set
	cell

	* appl/bos/bos_status.c (bos_status): check for server and set
	cell

2000-06-08  Love  <lha@s3.kth.se>

	* doc/partsofarla.texi: expand pioctl stuff
	* doc/servers.texi: point out again the importance of the
	"comments" in the CellServDB file
	* doc/afs-basics.texi: clearify CellServDB and AFSDB
	
2000-06-08  Harald Barth  <haba@pdc.kth.se>

	* doc/afs-basics.texi: Added verbs to sentences and other spelling
	business.
	* doc/servers.texi: This should be said somewhere.

2000-06-07  Love  <lha@s3.kth.se>

	* arlad/fcache.c (fcache_get_data): remove #if 1, that was for -t
	protection
	* arlad/arla.c (main): for -t call xfs_message_init()
	* arlad/kernel.h (kernel_args): remove device_file
	(kernel_device): added prototype
	* arlad/arla.c (main): call kernel_opendevice() where apropriate
	* arlad/kernel.c (kernel_opendevice): break out kern_open of
	kernel_interface
	(kern_interface): add the new "null" interface
	(null_{open,read,write}): "null" interface

	* doc/authors.texi: mention rhapsody port and disco code
	* doc/*.texi: spelling
	
2000-06-05  Harald Barth  <haba@pdc.kth.se>

	* xfs/linux/xfs_message.c: change XFS{,_ID}_INVALID_DNLC
	* xfs/bsd/xfs_message.c: change XFS{,_ID}_INVALID_DNLC
	* xfs/solaris/xfs_message.c: change XFS{,_ID}_INVALID_DNLC
	* xfs/winnt/src/xfs_message.c: change XFS{,_ID}_INVALID_DNLC

2000-06-05  Love  <lha@s3.kth.se>

	* ydr/output.c (genin): make input only arguments const
	
	* rxkad/osi_alloc.c (osi_Alloc,osi_Free): add prototype to avoid
	warning
	* rxkad/compat.c: added prototype for initialize_rxk_error_table()
	to avoid warning
	
	* doc/Makefile.in: remove some unused stuff
	* Makefile.in (SUBDIRS): += doc.
	
2000-06-05  Harald Barth  <haba@pdc.kth.se>

	* xfs/include/xfs/xfs_message.h: name change:
	XFS{,_ID}_INVALID_DNLC

	* lib/bufdir/fdir.h: add const to VenusFid decls

	* arlad/messages.c: My compiler didn't like the report_fid
	declaration inside the do { } while when it is used in the while
	expression.

	* INSTALL: Added some comments about ports (for all the firewall
	owners)

2000-06-05  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fcache_get_data): bump in new data for resolved
 	mount point

	* arlad/fcache.h (FCACHE_VERSION): bump

	* arlad: merge in `fake-mp' code

2000-06-04  Love  <lha@s3.kth.se>

	* doc/afs-basics.texi: spelling, linked in into the tree.
	* doc/arla.texi: added "Description of AFS infrastructure"
	
2000-06-03  Love  <lha@s3.kth.se>

	* arlad/cmcb.c (RXAFSCB_InitCallBackState{2,3}): update to new
	definitions

2000-06-02  Love  <lha@s3.kth.se>

	* cf/krb-version.h: name the file ${PACKAGE}-version.h
	* arlad/arla.c: use <arla-version.h>
	
	* cf/check-kerberos.m4: try to not pollute the cache
	* ydr/output.c (encode_string): change order of %s left
	pharentesis

2000-06-02  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* rxdef/cb.xg: correct initcallbackstate confusion

	* rxdef/volumeserver.xg: added constants

2000-06-01  Love  <lha@s3.kth.se>

	* appl/afsutils/klog.c: cmd-ify
	* appl/afsutils/klog.ctx: help text for mdoc page.

	* rx/Makefile.in: add and enable rxdebug, install/install rxdebug 
	* rx/rxdebug.c: clean up, made compile

	* lib/Makefile.in: add and enable cmd
	* lib/cmd/cmd.c(print_usage): added CMD_MANDOC stuff
	(cmd_PrintSyntaxManDoc): dont print argument twice with one
	command commands
	(*): s,params,parms,

	* lib/cmd/*: a cmd parser with mandoc support

2000-05-25  Love  <lha@s3.kth.se>

	* tests/mkdir: more paranoia
	
2000-05-24  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_message.c (gc_vnode): use d_prune_aliases
	(d_prune_aliases): define if !LINUX2_3

	* arlad/arla.c (print_dir): do not assume that strftime handles %F
	* cf/check-kerberos.m4: empty then-clause makes sh grumpy also add
	some more random libraries when seeking krb5
	
	* xfs/linux/xfs_inodeops.c (xfs_d_delete): make it always return
	an `int'.  the signature was changed in 2.3.99-pre9 and this
	should be safer.  removing the warning for older code would
	require an autoconf test
	* xfs/linux/xfs_syscalls.c (fhopen_call): declare `error'

2000-05-23  Assar Westerlund  <assar@sics.se>

	* cf/check-kerberos.m4: make no to everything actually be no
	prepend -L to libraries
	* cf/check-kerberos.m4: handle given and not-given arguments
	better.  fix library checking loops

2000-05-23  Love  <lha@s3.kth.se>

	* appl/lib/fs_lib.c (fs_invalidate): added
	* appl/fs/fs.c: (invalidate_cmd): added
	
	* cf/check-kerberos.m4 (krb5 compat) added KRB4_LIB_DIR
	(krb4) change order of extra libs and KRB4_LIB_DIR
	
	* xfs/linux/xfs_message.c (xfs_message_installnode): sync comment
	with code

2000-05-22  Assar Westerlund  <assar@sics.se>

	* arlad/volcache.c (get_info_oop): conditionalize the use of
	RXKADEXPIRED
	* arlad/conn.c (conn_rxkad_level): conditionalize on KERBEROS
	* tests/*.c: always call set_progname.  make all tests buildable
	even without KERBEROS

	* xfs/linux/xfs_vfsops.c (make_root): no need to set valid to
	zero, since it's done in xfs_d_init
	* xfs/linux/xfs_syscalls.c (fhopen_call): call get_write_access
	* arlad/messages.c: make sure that all sub-functions of
	xfs_message_pioctl either send a wakeup themselves or that they
	get breaked from the switch and get handled at the end of
	xfs_message_pioctl.

	* tests/rename-under-feet.c (child_chdir): print cwd to fd 4
	* tests/run-tests.in (ARLA_TESTS): add rename-under-feet
	* tests/rename-under-feet.c (kill_child): do not be that brutal
	* tests/rename-under-feet.c (child_chdir): remember to exit in
	child
	* tests/rename-under-feet.c (child_chdir): print cwd in child
	* tests/rename-under-feet.c (child_chdir): invert fork-condition
	* tests/rename-under-feet.c: new test

2000-05-19  Assar Westerlund  <assar@sics.se>

	* rxdef/Makefile.in (CLIENTSONBJS): add bos.cs.o

2000-05-19  Love  <lha@s3.kth.se>

	* arlad/arla.c (print_dir): verbose info
	(arla_ls): ls -l

2000-05-18  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_d_delete): remove unused code

2000-05-18  Assar Westerlund  <assar@sics.se>

	* lib/ko/Makefile.in (LIBS): add all the known (and required libs)

2000-05-16  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs/xfs_locl.h (xfs_root): replace with
 	xfs_replace_root
	* xfs/linux/xfs_inodeops.c (xfs_d_validate): rename to
 	xfs_d_revalidate
	(xfs_as_writepage, xfs_as_readpage): update to signatures as of
	2.3.99-pre8
	(try_replacing): new function that tries to do a root-swap when it
	detects that we're using a fake root
	(xfs_dead_lookup): use try_replacing
	* xfs/linux/xfs_vfsops.c (make_root): install the new root before
 	replacing it
	* xfs/linux/xfs_vfsops.c (xfs_replace_root): new function for
 	replacing the root with a new one.  this just replaces the
 	`xfs_node' part of the root inode.
	(make_root_vnode): new function for making a `fake' root node
	* xfs/linux/xfs_node.c (clear_xfs_node): correct debug output to
 	print the correct function name

	* arlad/volcache.c (get_info_loop): make sure we re-try correctly
	when we get back `token expired'

	* ydr/output.c: handle the case of OUT parameters of type STRING
	<>.  they need to be `char **' and not only `char *'.  also fix
	problem with not passing STRINGs correctly to server-side work
	functions.
	* ydr/types.h (enum argtype): make named

	* rxdef/bos.xg: correct error codes and opcodes

2000-05-15  Love  <lha@s3.kth.se>

	* Release 0.33.1
	
	* appl/lib/arlalib.c (arlalib_get_token_id): new function
	
	* tests/run-tests.in (ARLA_TESTS): added kotest
	* tests/kotest: added new test
	* lib/ko/Makefile.in: added kotest target
	* lib/ko/kocell.c (cell_expand_cell): add new function, inspired
	by allbery <allbery@ECE.CMU.EDU>

	* cf/check-kerberos.m4 (AC_KRB4_LIB_WHERE1): break for-loop if
	entry found

2000-05-15  Assar Westerlund  <assar@sics.se>

	* appl/afsutils/klog.c (afs_id): use arlalib_get_token_id_servers
	* appl/lib/arlalib.c (arlalib_get_token_id_servers): add
	(arlalib_get_token_id): fix

	* arlad/kernel.h (kern_read, kern_write): update prototypes

	* include/kafs.h (_PATH_ARLA_VICE): add
	
2000-05-14  Assar Westerlund  <assar@sics.se>

	* arlad/kernel.c (*_read, *_write): change signatures to those of
	read and write

	* xfs/linux/Makefile.in (uninstall): remove SHARED_LIBS
	* conf/Makefile.in (CONF_FILES): add SuidCells
	* conf/SuidCells: add a default (empty)

	* tests/rm-rf.c, tests/kill-softly.c, tests/kill-softer.c: single
	unix standard (and probably posix) says that unlink(directory)
	should return EPERM and not EISDIR.  accept both.

	* make-release, make-relase.el: new files

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): we always have
	vfs_getnewfsid in all support OSes.  same thing with struct
	fstatfs.f_fstypename

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhtovp): current should probably
	be curproc.  adding missing \n

	* xfs/*/xfs_syscalls*.c (remote_pioctl): convert ENODEV
	into EINVAL, otherwise kafs does not think there's pioctl support
	when arlad is not alive

2000-05-12  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_syscalls.c (user_path2dentry): new function that's
	basically namei, but implemented different on 2.3 and earlier.
	(sys_afs_int): just map ENODEV to EINVAL (otherwise kafs is unhappy)

	* xfs/linux/xfs_message.c (xfs_message_installdata): use
	path_init/path_walk on 2.3 (lookup_dentry is dead).
	* xfs/linux/xfs_vfsops.c (xfs_read_super): use path_init/path_walk
	on 2.3 (lookup_dentry is dead).

2000-05-12  Love  <lha@s3.kth.se>

	* xfs/winnt/bin/xfs-helper.c: added tcp-forwarder
	* lwp/plwp.c: (LWP_INT_WAIT): change windows code
	
	* xfs/winnt/bin/makefile: add more tools
	
	* arlad/xfs.c: use kern_write
	* arlad/kernel.[ch]: new kern interface

	* xfs/winnt/README: osr tools have moved
	
2000-05-10  Love  <lha@s3.kth.se>

	* appl/fs/fs.c (arladebug_cmd, xfsdebug_cmd): try to be nicer when
	parseing commandline

2000-05-09  Love  <lha@s3.kth.se>

	* cf/check-kerberos.m4 (AC_KRB4_LIB_WHERE1): added fbsd security
	compat (req com_err)

2000-05-09  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): separate device was
 	closed from we got signal so we do not have to lie to the user

	* xfs/bsd/xfs_wrap-bsd.c (SYSCALL_MODULE): set `xfs_sycall_num' so
	all syscall installations work the same way
	* arlad/fcache.c (real-extra_file_name): a new function that does
	not do any checks and does the real work of fcache_extra_file_name

	* xfs/bsd/xfs/xfs_locl.h (osf): add forward declaration of struct
 	vop_generic_args

2000-05-07  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_dev-common.c (xfs_cursig): osf glue
	(xfs_message_rpc, xfs_devread): use xfs_cursig
	* xfs/bsd/xfs_message.c (xfs_message_invalidnode): osf compat for
	v_writecount
	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): osf compat with
	P_WEXIT
	* lwp/make-process.o.sh.in (HOST_CPU): use globing for alpha
	* configure.in (osf): enable to use a specific build-tree

2000-05-07  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fcache_create_file): unlink the (potential)
	extra directory
	(fcache_recover_state): bump current_vnodes

	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): set catch correctly

	* xfs/linux/xfs_dev.c (xfs_devopen, xfs_devclose, xfs_devread,
 	xfs_devwrite, xfs_devpoll): do lock and unlock kernel.  the new
 	world order requires us to do the locking here ourselves.  this
 	should not be a problem with older kernels, since we should be
 	able to call lock_kernel with the kernel already locked.

2000-05-06  Assar Westerlund  <assar@sics.se>

	* appl/fs/fs.c (listcells_cmd): try to correct usage
	(afs_listcells): cells begin with one, not zero

2000-05-02  Love  <lha@s3.kth.se>

	* xfs/winnt/src/xfs_deb.c (xfs_log): new version
	* tests/ga-test.c: make things arg_mandatory so they can be
	automagicly matched

2000-05-02  Love  <lha@s3.kth.se>

	* Release 0.33

2000-05-01  Harald Barth  <haba@pdc.kth.se>

	* appl/lib/Makefile.in: ln -s gets upset if the (target) file
	exists

	* lib/acl/Makefile.in: removed roken_rename.h rule.

2000-05-01  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_message.c (xfs_message_installnode): if installing
 	on a positive dentry that already has the inode that we're
 	installing, set the dentry to valid.

	* xfs/bsd/xfs_vfsops-*bsd.c: use standard locking for dead vnodes
	* xfs/bsd/xfs_wrap-bsd.c (xfs_mod): print assigned numbers

	* appl/amon/Makefile.in (AMON_LIBS): re-order X libraries

2000-05-01  Love  <lha@s3.kth.se>

	* configure.in: dectect netbsd1.4.2 and build everything static
	* INSTALL: note on netbsd1.4.2

2000-04-30  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_dev.c (xfs_fops): use new style struct init
	(*): break long lines

	* xfs/linux/xfs_inodeops.c (xfs_dentry_operations):
	s,d_validate,d_revalidate,

2000-04-30  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c: correct some debug print update to new StoreData
	(add_to_invalidate): remove if already there
	* rxdef/fs.xg (StoreData): does not actually return a callback

	* xfs/linux/xfs_inodeops.c (xfs_dentry_operations): use new-style
 	struct initialization
	(xfs_readdir): print more errors
	* xfs/linux/xfs_vfsops.c (xfs_sops): use new-style struct
 	initialization

	* arlad/messages.c (xfs_message_rename): install data for child
 	directory when needed
	* arlad/inter.c (cm_rename): if we're moving a directory between
 	two directories, we need to fixup `..'
	* lib/bufdir/fdir.c (fdir_changefid): remove unused argument
	* tests/rename5.c: new test

2000-04-29  Assar Westerlund  <assar@sics.se>

	* cf/check-kerberos.m4: change include order when testing for krb5
 	compat

	* configure.in: check for old libkafs
	* appl/afsutils/klog.c (get_afs_token): optionally call
 	k_afslog_uid (old name for krb_afslog_uid)

	* xfs/linux/xfs/xfs_locl.h (I_BLOCKS_BITS): define
	* xfs/linux/xfs_node.c (xfs_attr2inode): use >> instead of / to
	calculate # of blocks to make old gcc happy
	* xfs/linux/xfs_inodeops.c (update_from_cache_node): new function
	to update inode when cached node has changed.  call it.

2000-04-28  Love  <lha@s3.kth.se>

	* xfs/linux/bin/arla.init.in: Added support for SuSE && YaST, add
	some documentation

	* xfs/winnt/inc/xfs_type.h: clearify what cpu we want (or not)
	* xfs/winnt/src/sources (SOURCES): added xfs.rc
	* xfs/winnt/src/xfs_vops.c: remove some warnings
	* xfs/winnt/src/xfs_init.c: move around and make it work

2000-04-28  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (add_to_invalidate): cancel the potential
 	sleeping beauty/beast (or invalidator)

	* xfs/linux/xfs_vfsops.c (xfs_read_super): use the LOOKUP_POSITIVE
 	constant instead of just `1'
	* xfs/linux/xfs_syscalls.c (fhopen_call): use dentry_open for 2.3
	* xfs/linux/xfs_message.c (xfs_message_installdata): use
 	lookup_dentry for 2.3 now that it has been exported (in
 	2.3.99pre6)

2000-04-27  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs/xfs_syscalls.h: export xfs_syscall_num
	* xfs/bsd/xfs_syscalls-wrap-freebsd.c (*):
	s,syscall_offset,xfs_syscall_num,
	* xfs/bsd/xfs_syscalls-wrap-bsd.c (*):
	s,syscall_offset,xfs_syscall_num,

2000-04-26  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* INSTALL: Added note about Mac OS X

	* xfs/bsd/bin/startarla.in: Added Mac OS X support

2000-04-23  Assar Westerlund  <assar@sics.se>

	* configure.in (freebsd): always add `-O' to make the xfs module
	compile.  See FreeBSD PR kern/17614

2000-04-22  Assar Westerlund  <assar@sics.se>

	* configure.in (freebsd): add `-mno-fp-regs' on alpha

2000-04-20  Assar Westerlund  <assar@sics.se>

	* arlad/inter.c (cm_rename): use VenusFid_cmp when comparing old
	and new parent fid so that we actually perform a full comparison
	
2000-04-20  Love  <lha@s3.kth.se>

	* tests/append-over-page.c: define MAP_FAILED for those whom lack
	it
	* configure.in: enable us to build lwp with windows threads,
	pthread and asm threads on cygwin
	* lwp/testlwp.c (main): do exit where approriate
	* lwp/plwp.c: define and use lwp_timerclear instead of timerclear
	* lwp/lock.h: clean up
	* xfs/winnt/README: expand what ddk you'll need

	* xfs/winnt/README: expand what ddk you'll need

2000-04-19  Assar Westerlund  <assar@sics.se>

	* tests/mmap-shared-write.c: new test

2000-04-19  Love  <lha@s3.kth.se>

	* cf/check-kerberos.m4: changed order of exporting varibles of
	krb5 and krb4 define kerberos in case we have krb5(only) too.
	rewrite krb5 compat stuff, and tune to death

	* tests/mkm-rmm: use setacl and more paranoia

	* conf/CellServDB (rhic): updated

2000-04-19  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/bin/startarla.in: call mknod for 128,0 if we're using an
	KLD module, because that for now means FreeBSD.  Since kern/9478
	has been laying waiting for over a year and since we always use
	that number, we might anyways just do that.

	* tests/mmap-shared-write.c: new test

2000-04-18  Love  <lha@s3.kth.se>

	* cf/check-kerberos.m4: clean up, change order of krb5 and krb4
	test, make it work ?

2000-04-16  Assar Westerlund  <assar@sics.se>

	* lwp/make-process.o.sh.in: allow overriding of CC, GCC, CPP, and
 	AS

	* xfs/linux/xfs_syscalls.c (fhget_call, xfs_fh_to_dentry): change
 	to make up the file-handle of
	(dev,inode,gen).
	(fhopen_call): first cut at opening files in 2.3.99-pre5
	* xfs/linux/xfs_message.c (xfs_message_installdata): skip using
 	open_namei and instead do walk_init/walk_name for 2.3.99-pre5
	* xfs/linux/xfs_vfsops.c (xfs_read_super): lookup_dentry changed
 	in 2.3.99pre-n (for some value of n).

	* arlad/messages.c (xfs_message_remove): don't set the data token
 	when installing the limbo entry if data is not installed

2000-04-14  Assar Westerlund  <assar@sics.se>

	* tests/fs-sa-la: redirect output to avoid it without -verbose
	* arlad/fcache.c (setacl): release the FCacheEntry if we fail
	* arlad/messages.c (xfs_message_remove): don't return a bogus
	error when it was actually succesful

2000-04-13  Love  <lha@s3.kth.se>

	* test/fs-sa-la: new test
	
	* xfs/linux/xfs_inodeops.c (xfs_follow_link): changed for
	2.3.99-pre4

	* xfs/linux/xfs_message.c (xfs_message_installdata): changed
	open_namei workings for 2.3.99-pre4

2000-04-12  Love  <lha@s3.kth.se>

	* arlad/messages.c (xfs_message_remove): do installattr instead of
	installnode now that we have disabled the warning message in
	installattr.

2000-04-03  Love  <lha@s3.kth.se>

	* tests/mkm-rmm: mount-point tests

2000-04-03  Assar Westerlund  <assar@sics.se>

	* appl/pts/pts.c (*): use arlalib_try_next_db
	* appl/lib/arlalib.h (arlalib_try_next_db): add prototype
	* appl/lib/arlalib.c (arlalib_try_next_db): add

	* arlad/inter.c (cm_ftruncate): make sure we have the data before
 	truncating to non-zero length

	* arlad/fcache.c: revert the try_next_fs part of last commit
	* arlad/fcache.c (stale): remove clearing of `datap', only done in
 	`throw_data'
	(*): clarify find_first_fs - find_next_fs loop
	* appl/lib/arlalib.c (arlalib_first_db): allow explicit `host'
	(NULL means pick from cell-db)

	* appl/pts/pts.c: make remaining functions loop over db's.  allow
	all commands to use a specified db server.  const-ize some.
	* appl/pts/pts.c (pr_create, create_cmd): add `-owner'
	* appl/pts/pts.c (*): make all arg_printusage print the
	sub-command before the options
	* appl/pts/pts.c (pr_create): write debug correctly
	* appl/pts/pts.c (pr_create): make the handling of `id' more
 	obvious/correct/something

	* xfs/solaris/xfs_vnodeops.c (xfs_setattr): only send length and
 	mtime if we actually have data
	* xfs/bsd/xfs_vnodeops-common.c (xfs_setattr_common): only send
 	length and mtime if we actually have data

	* xfs/linux/xfs_vfsops.c (xfs_notify_change): only send length and
 	mtime if we actually have data
	* xfs/linux/xfs_inodeops.c (xfs_setattr): only send length and
 	mtime if we actually have data

	* xfs/linux/*.c: add (int) casts where required for
 	%.*s format strings

2000-04-01  Assar Westerlund  <assar@sics.se>

	* xfs/*/xfs_dev.c (xfs_devread): only return entire messages

	* xfs/bsd/xfs_dev-common.c: add come const-ness
	(xfs_devread): print the signal that interrupted us

2000-03-28  Assar Westerlund  <assar@sics.se>

	* appl/lib/arlalib.h (db_server_context): remove synchost and
	nconn

	* appl/lib/arlalib.c (arlalib_first_db, arlalib_next_db,
	free_db_server_context): new functions for looping over all
	database servers.  From Harald Barth <haba@pdc.kth.se>
	* appl/pts/pts.c (examine_cmd, pr_adduser): use arlalib_first_db,
	arlalib_next_db to iterate over all db servers.
	(pr_create_user): loop over db servers
	* appl/lib/arlalib.h (db_server_context, arlalib_first_db,
	arlalib_next_db, free_db_server_context): add

2000-03-27  Love  <lha@s3.kth.se>

	* xfs/linux/xfs/xfs_node.h (struct xfs_node): added coments

	* INSTALL: add --with-sys=dir and KERNEL_CFLAGS

2000-03-25  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs/xfs_node.h (struct xfs_node): remove unused field
	`i_ino'

	* xfs/linux/xfs_inodeops.c (xfs_readdir): ignore deleted entries
	with fileno == 0
	* configure.in (solaris): add test for vfsops.vfs_freevfs
	* xfs/solaris/xfs_vfsops.c (xfs_freevfs): add on solaris8
	* xfs/solaris/bin/mount_xfs.c: upgraded to be compatible with the
 	large changes in solaris 8 (in other words, do not print any
 	warnings if opening /etc/mnttab fails with ENOSYS)

	* xfs/linux/xfs_dev.c (xfs_message_rpc): print out the signal we
	got interrupted by

	* tests/readdir-vs-lstat.c (verify_inodes): do not care if we're
	not allowed to stat
	* tests/kill-softly.c (kill_one): both possitive and negative
	checks
	* tests/kill-softer.c (kill_one): both possitive and negative
	checks
	
	* configure.in: add freebsdelf* (new sysname invented by the new
	version of config.guess). also add netbsdelf*

	* xfs/linux/xfs_vfsops.c (xfs_notify_change): set size for regular
	files and always mtime.  move down inode_setattr.
	* xfs/bsd/xfs_vnodeops-common.c (xfs_setattr_common): set size on
	regular files and always mtime.  let `vap' have priority over
	xn->attr
	* xfs/solaris/xfs_vnodeops.c (xfs_setattr): always copy size and
	mtime, they can be more current.  only use seconds parts of mtime
	time stamp.  only set size on regular files.  let `vap' have
	priority over xn->attr

	* arlad/messages.c (xfs_message_remove): use `limbo_status' and
	not the potentially bad limbo_entry->status

2000-03-25  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_write_file): make it work again

2000-03-24  Marcus Sundberg  <mackan@stacken.kth.se>

	* xfs/linux/xfs_dev.c:
	Removed check for HAVE_STRUCT_FILE_OPERATIONS_FLUSH as it's not
	defined anymore.
	Changed xfs_devselect -> xfs_devpoll.

	* xfs/linux/xfs_inodeops.c:
	Fix typo (generic_read_file -> generic_file_read).
	Fixed warnings about unused declarations.

	* xfs/linux/xfs_load.c:
	Need to unregister_filesystem() if we can't register xfs0 device.

2000-03-24  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_inodeops.c: move functions around to make blocks
	of !LINUX2_3 code, start to use generic_file_{read,write} for
	linux 2.3, added more comment headers

	* configure.in: removed test for getattr and setattr for linux

2000-03-24  Assar Westerlund  <assar@sics.se>

	* tests/append-over-page.c: new test

	* xfs/bsd/bin/mount_locl.h: add "xfs" for Darwin/MacOS X, and do
	#error if MOUNT_XFS is not defined
	* xfs/bsd/Makefile.in (xfs_vopdefs.h): generate from vnode_if.h
	instead of vnode_if.src
	(which might not always be present)

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): initialize the vm
	object on Darwin/MacOS X

2000-03-24  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* lwp/process.m68k.S: Remove bogus .globl Added _C_LABEL around
	PRE_Block

2000-03-24  Assar Westerlund <assar@sics.se>

	* xfs/bsd/xfs_node-bsd.c (xfs_cnp_init): handle the different hash
	function used on Darwin/MacOS X

	* xfs/bsd/xfs_dev-bsd.c (xfs_install_device): create devfs nodes
	for Darwin/MacOS X.  also remove them in xfs_uninstall_device

2000-03-22  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_syscalls-wrap-bsd.c:
	s,HAVE_SYS_LKMNOSYS,HAVE_KERNEL_SYS_LKMNOSYS,

2000-03-21  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_dev-bsd.c (xfs_install_device): return error if
	installing cdev fails

2000-03-21  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_dev-bsd.c (xfs_uninstall_device): cdevsw_remove
	return the entry it operated on or -1.

2000-03-18  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* xfs/bsd/*.c, xfs/bsd/xfs/*.h: More MacOS stuff

	* xfs/bsd/xfs/xfs_wrap.h, xfs/bsd/xfs_info.c,
	xfs/bsd/xfs_vfsops-macos.c: Added file

2000-03-20  Assar Westerlund  <assar@sics.se>

	* appl/udebug/udebug.c: add `-long' mode.  based on a patch from
	Dr A V Le Blanc <LeBlanc@mcc.ac.uk>

	* tests/run-tests.in: replace date +%s with date
 	+%Y-%m-%d-%H-%M-%S

2000-03-19  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_inodeops.c: major cleanup of operations struct's

	* tests/kill-softly.c: removed unused varible

	* xfs/linux/xfs/xfs_locl.h: implement DECLARE_FSTYPE for linux
	pre-2.3 add XFS_RESET_I_MAPPING

	* xfs/linux/xfs_vfsops.c (xfs_{get,put}_super):
	MOD_{INC,DEC}_USE_COUNT is done i vfs now

	* xfs/linux/xfs_load.c (xfs_fs_type): use DECLARE_FSTYPE

	* xfs/linux/xfs_message.c (xfs_message_installdata): use
	__open_namei for 2.3.99, set i_mapping for the xfs-node, clean
	printf's
	(xfs_message_invalidnode): clean i_mapping when loosing node

	* xfs/linux/xfs_inodeops.c (xfs_readlink): implement with
	page_readlink i 2.3
	(xfs_follow_link): implement with page_follow_link i 2.3
	(*): clean up
	(xfs_readdir): implement readdir with buffer-cache in 2.3
	(xfs_as_*): Opps when called
	
	* tests/run-tests.in: added date to tmpdir

	* xfs/linux/xfs_vfsops.c (xfs_statfs): update header

2000-03-18  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs/xfs_locl.h (xfs_set_vp_size): introduce a generic
	macro for setting the size of a vnode.  use it.
	* xfs/bsd/xfs_message.c (xfs_message_installdata): call
	uvm_vnp_setsize with UVM
	* xfs/bsd/xfs_vnodeops-bsd.c (cleanup_cnp): add FREE_ZONE for
	macosx.  add xfs_pagein and xfs_pageout.  add some more ifdefs and
	debugs
	* xfs/bsd/xfs_vfsops-bsd.c (xfs_dead_lock): add hopefully the
	minimal amount of locking required for dead nodes
	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): handle the special
	case of the process cleaning up, in that case we cannot catch
	signals while sleeping
	* xfs/bsd/xfs_dev-bsd.c (xfs_uninstall_filesys): add debug print
	* xfs/bsd/xfs_common-bsd.c (xfs_alloc, xfs_free): use MALLOC and
	FREE, they exist everywhere

	* tests/mmap-vs-read.c, tests/mmap-vs-read2.c: new tests
	* tests/exit-wo-close.c: new test
	* tests/dd: avoid running test if there's no /dev/zero

2000-03-18  Love  <lha@s3.kth.se>

	* configure.in: Added test for vfsops.vfs_done

	* xfs/bsd/xfs_vfsops-netbsd.c (xfs_vfsops): added vfs_done field
	(xfs_done): added

	* conf/CellServDB (postech.ac.kr): updated

2000-03-18  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* xfs/bsd/*.c: Change all %p to %lx

2000-03-17  Assar Westerlund  <assar@sics.se>

	* rx/rx.h: use rxgencon.h.
	* ydr/output.c (generate_server_switch): return RXGEN_OPCODE if an
	unknown opcode is received.  From David Sanderson
	<david@transarc.ibm.com>

	* tests/apwd.c: new file
	* tests/Makefile.in: add apwd

2000-03-16  Assar Westerlund  <assar@sics.se>

	* configure.in: call AC_BSD_HEADER_VNODE_IF_H and remove old code
	for setting VNODE_IF_H

	* xfs/bsd/Makefile.in (MODULE_OBJS): use @VNODE_IF_H@
	* configure.in (VNODE_IF_H): set and subst

2000-03-16  Love  <lha@s3.kth.se>

	* appl/afsutils/klog.c (main): alway set KRBTKFILE
	From Chris Wing
	
	* conf/CellServDB (src.uchicago.edu): updated
	(rhic): updated

2000-03-15  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_syscalls-wrap-freebsd.c
	(install_first_free_syscall): try_install_syscall returns 0 on
	success
	(from xfs_syscalls-wrap-bsd.c:1.6)

	* arlad/solaris-subr.c (flushbuf): always use `struct dirent64'

2000-03-13  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* configure.in: Set MODLOAD/MODUNLOAD in BSD. More MacOS
	stuff. Include sys/time.h when including sys/proc.h.

	* xfs/bsd/Makefile.in: Use the autoconf variable MODLOAD

2000-03-11  Love  <lha@s3.kth.se>

	* appl/afsutils/*: Fixes by Chris Wing

	* lib/roken/getarg.[ch]: Chris Wing's arg_generic_string patch

	* xfs/include/xfs/xfs_messsage.h: cygwin glue

2000-03-11  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* (install_first_free_syscall): try_install_syscall returns 0 on
	success

2000-03-10  Assar Westerlund  <assar@sics.se>

	* Release 0.32

2000-03-10  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_vfsops.c (xfs_statfs): in 2.3.51, `struct statfs'
 	should not be copied to user-space, it's done by vfs_statfs
 	instead

	* arlad/fcache.c (getacl, setacl): store the retrieved status in
 	the fcache entry

	* arlad/messages.c (xfs_message_remove): work-around problems with
 	silly-flag
	(xfs_message_rmdir, xfs_message_rename): try do dir_remove_name

	* arlad/solaris-subr.c (dir_remove_name): use an maximal d_reclen
 	of DIRBUF.

	* appl/fs/fs.c (internal_mp): always follow symlinks when calling
	pioctl

	* arlad/solaris-subr.c (dir_remove_name): using a too large
	d_reclen is bad because readdir() can't cope with it being larger
	than the buffer size that's being used by opendir/readdir.  so
	let's take DIRBUF (defaulting to 1048) as a conservative estimate

	* xfs/solaris/xfs_dev.c (xfs_chpoll): always initialize return
 	values.  print correct function name in debug output.

2000-03-07  Assar Westerlund  <assar@sics.se>

	* rxkad/compat.c: merge from krb4: fix incompatible protos
	* xfs/linux/Makefile.in (SHARED_LIBS): set unconditionally to
	libgetcwd.so.  We assume that there's always a getcwd.  based on a
	bug report by Dave Morrison <dave@bnl.gov>

	* arlad/messages.c (xfs_message_remove): move up the setting of
	the silly flag to before get_attr, otherwise that call might fail.

2000-03-07  Love  <lha@s3.kth.se>

	* util/log.c (log_open): when not finding the log, return NULL
	* arlad/arladeb.c (arla_loginit): fail when there is no valid log

2000-03-06  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_load.c (init_xfs_fs): no code after ret

2000-03-04  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* configure.in, lib/roken/signal.c, xfs/rhapsody/Makefile.in,
	xfs/rhapsody/xfs_wrap.c, xfs/rhapsody/xfs/kernelServer.h: Mac OS
	support

2000-03-04  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_vfsops.c (make_dead_vnode): set `i_fop' on 2.3.x
	* xfs/linux/xfs_inodeops.c: fix up opreations vectors
	* xfs/linux/xfs_node.c (xfs_iget): conditionalize setting of
 	`i_fop'
	* xfs/linux/xfs_node.c (xfs_iget): set inode->i_fop
	* xfs/linux/xfs_message.c (xfs_message_installdata): set mapping
 	of the node to be that of the cache node.
	* xfs/linux/xfs_inodeops.c: adapt for 2.3.x (add address_space and
 	other stuff)

	* xfs/linux/xfs_inodeops.c (xfs_release_file): consider the vnode
 	as dirty if the cache node is

	* xfs/linux/xfs_inodeops.c (xfs_release_file): make debug prints
 	correct.  don't invalidate pages on 2.3.x

	* xfs/linux/xfs_message.c (xfs_message_installnode): use
 	full_name_hash - always works now
	* xfs/linux/xfs_inodeops.c: unifdef some
	* xfs/linux/getcwd.c: unifdef -UHAVE_STRUCT_NEW_STAT
	* configure.in (linux): remove unused tests

	* xfs/linux/bin/mount_xfs.c: new program
	* xfs/linux/bin/Makefile.in: add mount_xfs.
	(clean): remove arla and not arla.init
	* xfs/linux/xfs_vfsops.c (xfs_read_super): make reading of minor
 	device number work correctly
	* xfs/linux/xfs_vfsops.c (xfs_root): look at minor number
	(xfs_read_super): make into three arguments.  look at data if != NULL.
	(xfs_put_super): look at minor number
	* xfs/linux/xfs_dev.c (xfs_devread, xfs_devwrite, xfs_devselect):
	look at the minor device
	(xfs_print_sleep_queue): print sleep queues for all minor devices

	* xfs/linux/xfs_load.c (xfs_read_super): remove conditional
	* configure.in (AC_LINUX_FUNC_READ_SUPER_FOUR_ARGS): remove. not
	used any longer

2000-03-04  Love  <lha@s3.kth.se>

	* arlad/arla.c: add checkservers to testmode

2000-03-02  Love  <lha@s3.kth.se>

	* conf/CellServDB (ir.stadford.edu): renumber networks.

	* ydr/output.c (encode_string): make it alway not fail in the
	DECODE_RX case

2000-03-01  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_getattr, xfs_setattr): implement
	(xfs_write_file): set inode attributes even on 2.3

	* configure.in: test for inode_operations.default_file_ops
	* configure.in (linux): test for super_operations.notify_change
	* configure.in (linux): test for 2.3x getattr and setattr

	* xfs/linux/xfs_vfsops.c (xfs_delete_inode): always clear the
 	inode

2000-03-01  Love  <lha@s3.kth.se>

	* xfs/linux/bin/Makefile.in (install): create @sysconfdir@ from
	Tino Schwarze <tino.schwarze@informatik.tu-chemnitz.de>

2000-02-29  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_node-bsd.c (xfs_cnp_init): let it make some sense
	(xfs_dnlc_enter_name): use `xfs_cnp_init'

2000-02-28  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_vnodeops.c (xfs_rename): ignore errors if we
	fail to remove the `new' file
	(xfs_rmdir): remove the directory from the dnlc

	* tests/rename3: new test

	* xfs/linux/xfs_syscalls.c (xfs_debug_print): print # of nodes
	with XDEBNODE and no node

2000-02-26  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (getvolstat): if RXAFS_GetVolumeStatus does not
 	actually return a volume name, get it from the vldb instead

2000-02-26  Assar Westerlund  <assar@sics.se>

	* Release 0.31

2000-02-26  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_node.c (xfs_dnlc_lookup): always return the node
 	holded
	* xfs/solaris/xfs_syscalls.c: more debug prints
	* xfs/solaris/xfs_vnodeops.c (xfs_lookup): don't hold, already
 	done by dnlc_lookup
	(xfs_remove): remove dnlc entry for non-existant node
	* xfs/solaris/xfs_message.c (xfs_message_installdata): always
 	clear dnlc if XFS_INVALID_DNLC
	(gc_vnode): prune dnlc when count <= 1 -> hopefully it will relase
	nodes

2000-02-24  Assar Westerlund  <assar@sics.se>

	* configure.in (openbsd): use the same make magic as netbsd
	* xfs/bsd/xfs_vnodeops-common.c (xfs_inactive_common): don't send
 	any message to the daemon.  recycle the node immediately if it's
 	not valid.
	* xfs/bsd/xfs_message.c (xfs_message_invalidnode): only send
 	message on last close.  only invalidate name cache for children.
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_eopnotsupp, xfs_returnzero):
 	print name of operation

	* xfs/linux/xfs_vfsops.c (xfs_delete_inode): always queue
 	inactivation
	* xfs/linux/xfs_dev.c (xfs_queue_inactive): remove `chan'
	* xfs/linux/xfs_dev.c (xfs_queue_inactive,
 	xfs_empty_inactive_queue): take `xfs_channel *' instead of `int'
	* xfs/linux/xfs_dev.c (xfs_empty_invalid_queue): rename to
 	xfs_process_inactive_queue
	(xfs_empty_invalid_queue): new function to throw away nodes
	(xfs_devclose): call xfs_empty_invalid_queue
	* xfs/linux/xfs/xfs_common.h (XFS_MEM_XFSCACHE): remove, not used
	any longer
	* xfs/linux/xfs_common.c (xfs_tell_alloc): use printk consistenly
	* xfs/linux/xfs_inodeops.c (xfs_create, xfs_symlink, xfs_mkdir):
	set the gid
	* xfs/bsd/bin/startarla.in: add `-z' to arlad to be conservative
	* configure.in: add testing for int16 and u_int16
	* xfs/bsd/xfs_wrap-bsd.c (xfs_mod): add prototype (warn-hunting)
	* xfs/bsd/xfs_vnodeops-common.c (xfs_symlink_common): extra const
 	(more warning-hunting)
	* xfs/bsd/xfs_vfsops-common.c (xfs_unmount_common): move out
 	doforce as part of warning hunt

2000-02-20  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-osf.c (xfs_getpage): make it build on OSF5
	* xfs/bsd/xfs_vfsops-osf.c (xfs_fhtovp): try to handle both
	U_FD_SET and u_set_fe
	* xfs/bsd/xfs/xfs_fs.h: rename pag_t -> xfs_pag_t try to handle
	OSF that has `struct mount.m_info' instead of `m_data'
	* configure.in (osf): add test for ubc_lookup
	* configure.in (bsd): check for `struct mount.m_info'
	* configure.in: separate kernel_CFLAGS into kernel_CFLAGS and
	kernel_CPPFLAGS
	* configure.in: conditionalize <sys/cdefs.h>
	* configure.in (osf): cpus.h does not exist in all versions of
	OSF.  try inet.h instead.

2000-02-16  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs/xfs_node.h (xfs_node): add `invalid_list'
	* xfs/linux/xfs_vfsops.c (xfs_delete_inode): if we fail to send an
 	inactive node message
	(typically, because of out of memory), clear the node and add it to
	the inactive list
	* xfs/linux/xfs_node.c (new_xfs_node): initialize `invalid_list'
	(clear_xfs_node): does all that free_xfs_node does except the actual
	freeing
	* xfs/linux/xfs_inodeops.c (xfs_d_init): check xfs_alloc for
 	failure.  changed into returning error.  change callers.
	* xfs/linux/xfs_dev.c (xfs_channel): add `invalid_list'
	(xfs_queue_invalid, xfs_empty_invalid_queue): new functions for adding
	nodes to the list that should be invalidated and to iterate over
 	the list and invalidate
	* xfs/linux/Makefile.in (unload): add target

	* lwp/iomgr.c (IOMGR): retry also when the error code from select
 	is ENOMEM (this can happen on linux)

2000-02-16  Love  <lha@s3.kth.se>

	* xfs/linux/xfs/xfs_common.h (xfs_alloc,xfs_free): new prototypes

	* xfs/linux/xfs_common.c (xfs_alloc,xfs_free): use constant for
	xfs_{allocs,frees}

	* xfs/linux/bin/arla.init.in (start): don't fail when insmod
	succeed, from "Krysak, Tony" <tony.krysak@lmco.com>

2000-02-15  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fs_downp): new function for figuring out if the
	return code means that this fs should be mark as down
	(find_next_fs): new parameter if the previous connection should be
	disabled
	* xfs/linux/Makefile.in (load): create a map file

2000-02-14  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c: remove lots of bogus assert's remove trailing \n
	from arla_log fix some leaking of fcache entries add some missing
	post-conditions
	(fcache_realfid): also do the mount-point thing for (1,1)
	(get_root_of_volume): add parent reference to child volume
	* arlad/volcache.c (getbyid, getbyname): new static functions
	(*): set and use vol_refs
	(volcache_recover_state): find and set parent pointers
	(volcache_invalidate_ve): new function
	(volcache_volref, volcache_volfree): new functions for manipulating
	vol_refs remove trailing \n from arla_log
	* arlad/volcache.h (volcacheentry): add `vol_refs' and `parent'
	(VOLCACHE_VERSION): bump
	add new prototypes

	* arlad/bsd-subr.c (dir_remove_name): make the loop-invariant more
	correct.

2000-02-12  Assar Westerlund  <assar@sics.se>

	* arlad/subr.c (dentry2ino): fix typo in looking for root of a
 	volume

	* arlad/messages.c (xfs_message_remove): set silly flag after
 	fetching attributes

	* appl/asrvutil/Makefile.in: s/KRB_INC_FLAGS/KRB4_INC_FLAGS/
	* xfs/solaris/bin/Makefile.in:
 	s/KRB_{INC,LIB}_FLAGS/KRB4_{INC,LIB}_FLAGS/ add Makefile-rule

	* arlad/solaris-subr.c: start using the generic function in subr.c
	* arlad/subr.h (write_dirent_args): use `off64_t' if it exists to
 	help solaris.  We might be able to define and use the maximal int
 	type instead?
	* configure.in (off64_t): test for

	* appl/lib/Makefile.in (arladeb.c): sprinkle srcdir to help
 	not-so-bright makes

	* cf/check-kafs.m4: add Id. remove duplicate -L

	* arlad/conn.c (re_probe): don't assert that `e' is dead.  it
 	might have woken up
	(print_conn, conn_status): remove trailing \n from arla_log
	* arlad/fprio.c (fprio_status): remove trailing \n in arla_log
	* arlad/cred.c (cred_status, print_cred): remove trailing \n from
 	arla_log

2000-02-07  Love  <lha@s3.kth.se>

	* conf/CellServDB (cs.wisc.edu): updated

2000-02-05  Love  <lha@s3.kth.se>

	* arlad/messages.c (xfs_message_rmdir): remove superflous
	fcache_release (dir_entry);
	(xfs_message_remove): same as above

2000-02-04  Assar Westerlund  <assar@sics.se>

	* rx/rx.c (rxi_FindConnection): remember to update the peer in
 	`connection' when we discover that the corresponding host has
 	moved

2000-02-04  Love  <lha@s3.kth.se>

	* xfs/linux/bin/arla.init.in (start): don't probe for xfs.o

2000-02-03  Love  <lha@s3.kth.se>

	* xfs/linux/bin/Makefile.in (install): do ; right

2000-02-02  Love  <lha@s3.kth.se>

	* xfs/linux/bin/Makefile.in (arla.init): don't write over local
	changes

	* arlad/fcache.c (do_read_attr): move out silly test
	(bulkstat_help_func): check also if the rights is cached for this pag
	and if node is uptodatep(), don't save the names if we aren't
	going to use them.
	(get_attr_bulk): added locking protocol, make sure names are free:ed
	when needeed, make sure fs_server_context is free:ed, break out
	updating of in-core node updating of install to kernel loop.
	(fcache_get_attr): make sure node is uptodate too, add check for
	silly rename, make sure we do the right thing with ``parent'',
	merge with get_entry
	(get_entry): remove

2000-01-30  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_write_file): move debug prints
	inside the relevant ifdefs.  remove commented-out and way old page
	invalidation

	* lib/ko/gensysname.c (printsysname): add ko.h to get rid of a
	warning

2000-01-30  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* xfs/linux/xfs/xfs_locl.h, xfs/linux/xfs/xfs_common.h,
	xfs/linux/xfs_inodeops.c, xfs/linux/xfs_dev.c,
	xfs/linux/xfs_common.c: Drop Linux 2.0 support

2000-01-29  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_cache.c: removed file

	* xfs/linux/Makefile.in (MODULE_SRCS): remove xfs_cache.c

	* xfs/linux/xfs_load.c: remove linux 2.0-ism

	* xfs/linux/xfs_syscalls.c: remove linux 2.0-ism

	* xfs/linux/xfs_vfsops.c: remove linux 2.0-ism

	* arlad/{arla.c,messages.c,conn.[ch]):use conn_rxkad_level instead
	of rxkad_min_level

	* xfs/linux/xfs_inodeops.c: remove 2.0-ism

	* arlad/inter.c (*): changed to use new fcache_get_attr

	* arlad/messages.c (*): changed to use new fcache_get_attr

	* arlad/fcache.h (fcache_get_attr): new style

	* arlad/fcache.c (fcache_bulkstatus_num): number of nodes to
	bulkstatus
	(get_attr_bulk): rename function, don't insert into kernel default
	(fcache_get_attr): change funtion to do bulkstatus if needed, do
	dynroot stuff here too.
	(bulkstat_help_func): check if the node is already cached

	* tests/compare-inum-mp: set the rights bits on the directory
	before creating the mountpoint

2000-01-26  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_*lookup): removed 2.0-ism, at
	least its the same om 2.3.40 and 2.3.12+

	* arlad/messages.c (xfs_message_rmdir,unlink): be more carefull
	when releasing dir_entry. (this was fixed in the 0.29 branch but
	never pulled up)

	* xfs/linux/xfs_message.c (xfs_message_installattr): send a
	inactive node if we failed

	* conf/arla.spec.in: believed to work spec file for rpm's

	* conf/Makefile.in: added spec file

	* tests/read-vs-mmap.c: test both all-zeros and random bytes

2000-01-26  Marcus Sundberg  <mackan@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: fix typos

2000-01-25  Assar Westerlund  <assar@sics.se>

	* cf/check-kernel-var.m4: try to actually use the variable tested
	for so that this doesn't get optimized away by the compiler

2000-01-25  Love  <lha@s3.kth.se>

	* xfs/linux/Makefile.in (doclean): remove libgetcwd.so

	* configure.in (linux): test for bmap and smap

	* xfs/linux/xfs_inodeops.c: add some rough linux2.3 support, at
	least it does crash now.  remove 2.0 code need some better
	autoconf test, assume 2.3.40

	* xfs/linux/xfs_message.c: removed linux 2.0 code and fixed
	printing of pointers

2000-01-24  Love  <lha@s3.kth.se>

	* conf/CellServDB: added ops.mit.edu

	* xfs/linux/bin/Makefile.in (install): added missing ; and \ and
	removed osf/1-ism

2000-01-23  Assar Westerlund  <assar@sics.se>

	* configure.in: use AC_PROG_CC_FLAGS

2000-01-23  Love  <lha@s3.kth.se>

	* xfs/linux/{xfs_syscalls.c,xfs/xfs_locl.h}: setgroups32 patches
	from Chris Wing <wingc@engin.umich.edu>

	* *{,*/*}{,/*}/Makefile.in: s,KRB_,KRB4_,
	
	* xfs/linux/Makefile.in (getarg.o): no -fPIC since it doesn't
	work, _syscall2 uses bx.

	* xfs/linux/bin/arla.init.in: added linuxconf glue

	* xfs/linux/bin/Makefile.in (sysconfdir): added

	* configure.in: use new macron for finding kerberos and kafs

	* cf/check-kafs.m4: more generic way of finding kafs

	* cf/check-kerberos.m4: more generic way of finding kerberos

2000-01-22  Love  <lha@s3.kth.se>

	* xfs/linux/Makefile.in (getcwd.o): use -fPIC when compiling, its
	supposted to be faster acording to Greg Stark <gsstark@mit.edu>

	* xfs/linux/bin/arla.init.in: try to use modprobe

	* arlad/inter.c (cm_getattr): make sure if we have attributes that
	we have rights for the user too

	* xfs/bsd/bin/Makefile.in (install): fix typo, noticed by matt
	<deberg@mit.edu>

2000-01-21  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_readdir): warning if cache file is NULL
	(xfs_do_readlink): warning if cache file is NULL

2000-01-20  Love  <lha@s3.kth.se>

	* arlad/arla.c (main): check that we have a dbserver then running
	in -t

2000-01-19  Love  <lha@s3.kth.se>

	* Release 0.30

2000-01-18  Love  <lha@s3.kth.se>

	* ydr/parse.y (enumentries,enumbody): patch for automatic
	numbering from idea of Derrick J Brashear <shadow@dementia.org>

2000-01-17  Love  <lha@s3.kth.se>

	* tests/test-parallel1.c,tests/parallel1: create/chmod/unlink a
	file in 10 worker threads.

	* arlad/messages.c (xfs_message_remove): remember to set dir_entry
	to NULL.

	* arlad/messages.c (xfs_message_remove): don't release dir_entry
	when it's not used
	(viocsetacl): remove unused label

	* appl/fs/fs.c (afs_setacl): don't try to follow pointers when
	counter is 0

	* arlad/messages.c (viocsetacl): install the attributes when
	successful.

	* arlad/fcache.c (setacl): return the fcache entry when
	successful, remove the break_callback (its up to the caller (like
	rest of the code do it like this))

	* arlad/messages.c (xfs_message_remove): fixa
	remove-mountpoint-problem by doing operations in diffrent
	order. The problem is that the node still was in the namecache,
	and the we got a SoftAssert (on linux).

2000-01-16 Assar Westerlund  <assar@sics.se>

	* rxkad/rxk_crpt.c: more here endian-ness tests from acconfig.h
	* acconfig.h: remove endian-ness defines.  they cause troubles be
 	being here and are only used in rxkad anyways

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_readdir): unify much more
	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_lookup): remove extra unused
 	variables

	* xfs/bsd/Makefile.in (vnode_if.h): handle vnode_if.h hiding in
 	../sys/vnode_if.h

2000-01-16  Love  <lha@s3.kth.se>

	* lwp/Makefile.in: added dependency for rw.o (by Derrick J
	Brashear <shadow+@andrew.cmu.edu>)

2000-01-07  Assar Westerlund  <assar@sics.se>

	* lwp/make-process.o.sh.in: add -DASSEMBLER when running cpp
	* acconfig.h: don't look for endianess information in
	<sys/param.h> when assembling

	* acconfig.h: new ifdef-code to handle KRB_C_BIGENDIAN
	* configure.in: replace AC_C_BIGENDIAN with KRB_C_BIGENDIAN
	* cf/krb-endian.m4: better endian-ness.  stolen from Heimdal.

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhtovp): should send `mode' and
	not `flags' to VOP_ACCESS.  Thanks to <tol@stacken.kth.se> for
	debuggning help

	* arlad/messages.c (xfs_message_putdata): set correct error in
	wakeup

	* rxkad/rxk_clnt.c (rxkad_NewClientSecurityObject): make sure bit
 	31 is not set in the epoch.  this bit is used by rx to mean that
 	we should only match on connection-id and that means we never get
 	any port number updates when using NAT.

	* rx/rx.c (rxi_HasActiveCalls, rxi_FindService, rxi_DestroyPeer,
 	rxi_FindConnection, rxi_CheckCall, rxi_DecongestionEvent,
 	rxs_Release): static-ize
	(rxi_RemovePeer, rxi_InsertPeer, rxi_ChangePeer): new functions
	
	(rxi_FindConnection): only match based on host not port.  change saved
	port if it changes.  This allows much smoother function when
 	behind a NAT.  These devices from hell usually have a very short
 	timeout on UDP `sessions' and will assign you a new port without
 	you noticing.

2000-01-07  Love  <lha@s3.kth.se>

	* xfs/solaris/Makefile.in (load): don't remove the load tree since
	savecore needs it.

Fri Jan  7 11:36:25 2000  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* xfs/linux/{xfs_message.c,xfs_inodeops.c,/xfs/xfs_common.h}:
	New installnode code

2000-01-07  Love  <lha@s3.kth.se>

	* xfs/solaris/xfs_dev.c (xfs_message_receive): add support for
	XFS_MSG_{VERSION,GC_NODE}

	* xfs/solaris/xfs/xfs_msg_locl.h(xfs_message_{gc_nodes,version}):
	add prototypes

	* xfs/solaris/xfs_message.c (xfs_message_{gc_nodes,version}):
	implement
	(gc_vnode): try to gc a node

	* xfs/solaris/Makefile.in (AFS,mount,unmount): where we should
	mount afs

2000-01-05  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fcache_get): take care to (re-)initialize all
 	fields when re-using an entry

	* tests/generic-build: add an optional argument that specifies
 	what the directory will be called for tarbolls where it's not the
 	same as the file name without .tar.gz

	* lwp/lock.h: introduce a new cpp symbol LOCK_TRACE that keeps
	track in the lock of where (file and line) it was locked.  add
	support to the locking macros.  remove some unused (and notdef)
	code.

2000-01-02  Assar Westerlund  <assar@sics.se>

	* configure.in (CFLAGS): more warnings
	(freebsd3): test for vnode_if.pl and vnode_if.sh properly

	* xfs/bsd/Makefile.in (vnode_if.h): fix the tests for if the file
 	exists

	* lwp/make-process.o.sh.in: link the candidate assember file to
 	process.S before trying to assemble it

2000-01-02  Love  <lha@s3.kth.se>

	* lwp/Makefile.in(PROCESS_S): spelled .S

	* lwp/make-process.o.sh.in(PROCESS_S): spelled .S

	* (Makefile.in,make-process.o.sh.in,lwp_elf.h,process.aix22.S,
	process.alpha.S,process.hpux.S,process.i386.S,process.ibm032.S,
	process.m68k.S,process.mips.S,process.patch.S,process.ppc.S,
	process.rios.S,process.sparc.S,process.vax.S): split (and remove)
	process.S to diffrent arch-files, add ELF support for 68k

For older ChangeLog entries see ChangeLog.1999
